<!DOCTYPE html>
<html lang="dv" translate="no">
  <head>
    <!-- CHANGE !!! -->
    <title>الجامع في العقائد – އެއްކުރަމުންދާ އަގީދާގެ ފޮތްތައް</title>
    <meta
      name="description"
      content="The Maldivian Platform for Translations of the Sunnah | ސުންނަތުގެ ތަރުޖަމާ މަންސަ"
    />
    <meta
      name="keywords"
      content="hadithmv,hadith mv, hadeeth mv,dhivehi,hadith,ޙަދީޘްއެމްވީ,ޙަދީޘް އެމްވީ"
    />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta itemprop="name" content="Hadithmv" />
    <meta itemprop="description" content="ޙަދީޘްއެމްވީ" />
    <meta
      itemprop="image"
      content="https://hadithmv.github.io/img/logo/NewLogo7/hadithmv-logo-7.0-whiteBack-512px.png"
    />
    <meta property="og:title" content="Hadithmv" />
    <meta property="og:type" content="website" />
    <meta
      property="og:image"
      content="https://hadithmv.github.io/img/logo/NewLogo7/hadithmv-logo-7.0-whiteBack-512px.png"
    />
    <link rel="icon" href="../img/logo/logo.svg" type="image/svg+xml" />
    <meta name="theme-color" content="#29434e" />
    <link
      rel="stylesheet"
      href="../css/ALL-COMB.min.css"
      media="print"
      onload="this.media='all'"
    />
    <script src="../js/ALL-COMB.min.js"></script>
    <style></style>
  </head>
  <body>
    <div id="navbar-container"></div>
    <div class="dtWrapper">
      <table id="tableID" class="cards" width="100%"></table>
      <div class="hmvSection">
        <div class="centerAlignedText">
          <button
            id="copyPageLink"
            class="customButtons"
            onclick="copyURLToClipButton();"
          >
            &nbsp; ސަފުހާގެ ލިންކު ކޮޕީކުރޭ &nbsp;
          </button>
          <button
            id="toggleFiliButton"
            class="customButtons"
            onclick="toggleFili();filiString();scrollUpTop()"
          >
            &nbsp; ފިލިތައް ދައްކާ &nbsp;
            <!-- ފޮރުވާ -->
          </button>
          <button
            id="toggleShowButton"
            class="customButtons"
            onclick="toggleShowOne();scrollUpTop()"
          >
            &nbsp; ފުޓްނޯޓު ފޮރުވާ &nbsp;
          </button>

          <button class="customButtons" onclick="copyOneOnly();">
            &nbsp; ފިއްޔާއެކު ކޮޕީ &nbsp;
          </button>

          <script>
            // If column 3 is hidden, make it visible and hide column 4. Then trigger a click on .buttons-html5, and finally restore the original visibility states. If column 4 is visible and column 3 is hidden, hide column 4 and make column 3 visible. Then trigger a click on .buttons-html5, and finally restore the original visibility states. If column 3 is visible and column 4 is hidden, trigger a click on .buttons-html5 without changing any column visibility.
            function copyOneOnly() {
              var table = $(".dataTable").DataTable();

              // Get the current visibility status of columns 3 and 4
              var isVisible3 = table.column(3).visible();
              var isVisible4 = table.column(4).visible();

              // Function to change visibility and trigger export
              function changeVisibilityAndExport(showCol3, showCol4) {
                table.column(3).visible(showCol3, false);
                table.column(4).visible(showCol4, false);
                table.draw(false); // Redraw the table without resetting the paging

                // Use setTimeout to ensure the visibility changes are applied before exporting
                setTimeout(function () {
                  $(".buttons-html5").click();

                  // Restore original visibility after a short delay
                  setTimeout(function () {
                    table.column(3).visible(isVisible3, false);
                    table.column(4).visible(isVisible4, false);
                    table.draw(false);
                  }, 100);
                }, 100);
              }

              // If column 3 is hidden, make it visible and hide column 4
              if (!isVisible3) {
                changeVisibilityAndExport(true, false);
              }
              // If column 4 is visible and column 3 is hidden, hide column 4 and make column 3 visible
              else if (isVisible4 && !isVisible3) {
                changeVisibilityAndExport(true, false);
              }
              // If column 3 is visible and column 4 is hidden, just trigger the export
              else if (isVisible3 && !isVisible4) {
                $(".buttons-html5").click();
              }
            }
          </script>

          <script>
            // CHANGE !!!
            function toggleShowOne() {
              /*var isVisible = $(".dataTable").DataTable().column(8).visible();
              $(".dataTable").DataTable().column(8).visible(!isVisible);*/

              var isVisible = $(".dataTable").DataTable().column(6).visible();
              $(".dataTable").DataTable().column(6).visible(!isVisible);

              var button = document.getElementById("toggleShowButton");
              if (button.innerHTML.trim() === "&nbsp; ފުޓްނޯޓު ފޮރުވާ &nbsp;") {
                button.innerHTML = "&nbsp; ފުޓްނޯޓު ދައްކާ &nbsp;";
              } else {
                button.innerHTML = "&nbsp; ފުޓްނޯޓު ފޮރުވާ &nbsp;";
              }
            }
          </script>
          <script>
            function toggleFili() {
              var isVisible = $(".dataTable").DataTable().column(3).visible();
              $(".dataTable").DataTable().column(3).visible(!isVisible);

              var isVisible = $(".dataTable").DataTable().column(4).visible();
              $(".dataTable").DataTable().column(4).visible(!isVisible);
            }
          </script>

          <hr />

          <p>
            މިއީ ޙަދީޘްއެމްވީގައިވާ ހުރިހާ އަގީދާ ފޮތްތައް އެއް ތަނަކުން
            ސާޗްކުރެވޭ ސަފުހާއެވެ.
          </p>
        </div>
      </div>
    </div>
    <script type="text/javascript">
      // Configuration object for each JSON file
      const jsonConfigs = {
        "usooluSunnahAhmed.json": {
          keepColumns: [0, 1, 2, 3],
          //orderColumns: [5, 4, 2, 3, 1, 0], // Optional: specify desired column order
          newColumns: ["أصول السنة لأحمد"],
        },
        "sharhuSunnahBarbahari.json": {
          keepColumns: [0, 1, 2, 3],
          newColumns: ["شرح السنة للبربهاري"],
        },
        "aqidatuRaziyain.json": {
          keepColumns: [0, 1, 2, 3],
          newColumns: ["عقيدة الرازيين"],
        },
        "kitabulEmanAbiUbaid.json": {
          keepColumns: [0, 3, 5, 6],
          newColumns: ["كتاب الإيمان لأبي عبيد"],
        },
        "intisarLiAshabilHadith.json": {
          keepColumns: [1, 2, 3, 4],
          newColumns: ["الانتصار لأصحاب الحديث للسمعاني"],
        },
        "nawaqidulislam.json": {
          keepColumns: [0, 3, 4, 5],
          newColumns: ["نواقض الإسلام"],
        },
        "qawaidulArbau.json": {
          keepColumns: [0, 3, 4, 5],
          newColumns: ["القواعد الأربع"],
        },
        "usooluSiththa.json": {
          keepColumns: [0, 3, 4, 5],
          newColumns: ["الأصول الستة"],
        },
        "usooluThalaatha.json": {
          keepColumns: [0, 3, 4, 5],
          newColumns: ["الأصول الثلاثة"],
        },
        "sharhuSunnahBarbahari-DFK.json": {
          keepColumns: [0, 1], //[0, 1, 2] this time, i didnt add the ar text from my barbahari
          newColumns: ["شرح السنة للبربهاري - DFK"],
        },
      };

      // Modified processJsonData function to handle column padding
      function processJsonData(data, config, maxColumns) {
        return data.map((row) => {
          const fullRow = Array.isArray(row) ? row : Object.values(row);

          // Process the specified columns
          let processedRow = config.keepColumns.map((index) => {
            const value = fullRow[index];
            return value === null || value === undefined ? "" : String(value);
          });

          // Add new columns if specified
          if (config.newColumns && config.newColumns.length > 0) {
            processedRow = [...config.newColumns, ...processedRow];
          }

          // Reorder columns if orderColumns is specified
          if (config.orderColumns) {
            const tempRow = [...processedRow];
            processedRow = config.orderColumns.map((index) => {
              // If the index is within newColumns range, adjust accordingly
              const adjustedIndex = config.newColumns
                ? index + config.newColumns.length
                : index;
              return tempRow[adjustedIndex] || "";
            });
          }

          // Pad with empty strings if needed
          while (processedRow.length < maxColumns) {
            processedRow.push("");
          }

          return processedRow;
        });
      }

      var table = new DataTable("#tableID", {
        ...DTconfig,
        //
        ajax: function (data, callback, settings) {
          let loadedData = [];
          const files = Object.entries(jsonConfigs);

          // Calculate maximum number of columns across all configurations
          const maxColumns = Math.max(
            ...files.map(([_, config]) => {
              const baseColumns = config.orderColumns
                ? config.orderColumns.length
                : config.keepColumns.length;
              const extraColumns = config.newColumns
                ? config.newColumns.length
                : 0;
              return baseColumns + extraColumns;
            })
          );

          const loadSequentially = async () => {
            for (const [file, config] of files) {
              try {
                const response = await fetch(`../js/json/${file}`);
                if (!response.ok)
                  throw new Error(`HTTP error! status: ${response.status}`);

                const jsonData = await response.json();
                const processedData = processJsonData(
                  jsonData,
                  config,
                  maxColumns
                );
                loadedData = [...loadedData, ...processedData];

                // Update the table with current accumulated data
                if (table) {
                  table.clear();
                  callback({
                    data: loadedData,
                    recordsTotal: loadedData.length,
                    recordsFiltered: loadedData.length,
                  });
                }

                console.log(
                  `Loaded ${file}: Total rows now: ${loadedData.length}`
                );
              } catch (error) {
                console.error(`Error loading ${file}:`, error);
              }
            }
          };

          // Start loading process
          loadSequentially();
        },
        //

        // CHANGE !!!
        //columns: [null, null, null, null, null],
        // book	#	arText	dvText	Takhrij
        columns: [
          { title: "ފޮތް އަރަބިން", className: "colHeader" },
          /*{
            title: "ފޮތް ދިވެހިން",
            data: 0,
            render: (data) =>
              data
                .replace("أصول السنة لأحمد", "އަޙްމަދުގެ ސުންނަތުގެ އުސޫލުތައް")
                .replace(
                  "شرح السنة للبربهاري - DFK",
                  "ބަރްބަހާރީގެ ސުންނަތުގެ ޝަރަހަ - DFK"
                )
                .replace(
                  "شرح السنة للبربهاري",
                  "ބަރްބަހާރީގެ ސުންނަތުގެ ޝަރަހަ"
                )
                .replace("عقيدة الرازيين", "ދެ ރާޒީންގެ އަގީދާ")
                .replace(
                  "كتاب الإيمان لأبي عبيد",
                  "އަބޫ ޢުބައިދުގެ އީމާންކަމުގެ ފޮތް"
                )
                .replace("نواقض الإسلام", "އިސްލާމްކަން ގެއްލޭ ކަންތައް")
                .replace("القواعد الأربع", "ހަތަރު ގަވާއިދު")
                .replace("الأصول الستة", "ހަ އުސޫލު")
                .replace("الأصول الثلاثة", "ތިން އުސޫލު"),
            visible: false,
          },*/
          { title: "#" },
          {
            title: "އަރަބި ލިޔުން",
            searchable: false,
            visible: false, //FOR ALL TABLES, default is to show non fili
          },
          {
            title: "އަރަބި ފިލިނުޖަހާ",
            data: 2,
            render: (data) => removeThashkeel(data),
          },
          {
            title: "ދިވެހި ލިޔުން",
            data: 3,
          },
          { title: "ތަޚްރީޖު", data: 4, searchable: true },
        ],
        columnDefs: [
          {
            searchPanes: {
              show: true,
            },
            targets: [0],
          },
          ...columnDefsconfig,
        ],
      });
    </script>
  </body>
</html>
