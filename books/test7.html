<html>
  <head>
    <meta charset="utf-8" />
    <title>Instant View Manual</title>

    <link rel="icon" type="image/svg+xml" href="/img/website_icon.svg?4" />
    <link rel="alternate icon" href="/favicon.ico?4" type="image/x-icon" />
    <link href="/css/bootstrap.min.css?3" rel="stylesheet" />
    <link href="/css/bootstrap-extra.css?2" rel="stylesheet" />
    <link href="/css/telegram.css?205" rel="stylesheet" />
    <link href="/css/codemirror.css?1" rel="stylesheet" />
    <link href="/css/instantview.css?111" rel="stylesheet" />
  </head>
  <body class="" style="position: relative">
    <header>
      <div class="container">
        <div class="row">
          <div class="col-sm-12 col-lg-10 col-lg-offset-1">
            <div class="header-wrap">
              <div id="header-panel" class="header-panel">
                <div class="header-breadcrumb header-breadcrumb-simple">
                  <ol id="breadcrumb" class="header-nav breadcrumb">
                    <li class="iv-logo">
                      <a href="/"
                        ><i class="iv-icon"></i
                        ><span class="iv-logo-title">Instant View</span></a
                      >
                    </li>
                    <li class="" data-side-nav-item="">
                      <a href="/docs#">Manual</a>
                    </li>
                    <li class="active">Recent changes</li>
                  </ol>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>
    <main class="intro container">
      <div class="row">
        <div
          class="col-sm-3 col-sm-push-9 col-lg-offset-1 col-lg-3 col-lg-push-7"
        >
          <section class="nav-menu nav-menu-can-fix" style="width: auto">
            <ul class="nav nav-pills nav-stacked">
              <li><a href="/">Intro</a></li>
              <li><a href="/templates">Templates</a></li>
              <li><a href="/checklist">Checklist</a></li>
              <li><a href="/contest/winners2017">2017 Contest Winners</a></li>
              <li><a href="/contest/winners2019">2019 Contest Winners</a></li>
              <li class="divider"></li>
              <li><a href="/samples/">Sample Templates</a></li>
              <li><a href="/my/" data-need-auth="">My Templates</a></li>
              <li class="active">
                <a href="/docs">Manual</a>
                <div id="dev_side_nav_cont">
                  <div class="dev_side_nav_wrap">
                    <div class="dev_side_nav">
                      <ul class="nav navbar-nav navbar-default affix-top">
                        <li class="active">
                          <a
                            href="#recent-changes"
                            data-target="#recent-changes"
                            onmouseenter="showTitleIfOverflows(this)"
                            >Recent changes</a
                          >
                          <ul class="nav">
                            <li class="">
                              <a
                                href="#september-10-2020"
                                data-target="#september-10-2020"
                                onmouseenter="showTitleIfOverflows(this)"
                                >September 10, 2020</a
                              >
                            </li>
                            <li class="">
                              <a
                                href="#march-20-2019"
                                data-target="#march-20-2019"
                                onmouseenter="showTitleIfOverflows(this)"
                                >March 20, 2019</a
                              >
                            </li>
                            <li class="">
                              <a
                                href="#december-10-2018"
                                data-target="#december-10-2018"
                                onmouseenter="showTitleIfOverflows(this)"
                                >December 10, 2018</a
                              >
                            </li>
                          </ul>
                        </li>
                        <li class="">
                          <a
                            href="#instant-view-format"
                            data-target="#instant-view-format"
                            onmouseenter="showTitleIfOverflows(this)"
                            >Instant View Format</a
                          >
                          <ul class="nav">
                            <li>
                              <a
                                href="#rtl-support"
                                data-target="#rtl-support"
                                onmouseenter="showTitleIfOverflows(this)"
                                >RTL support</a
                              >
                            </li>
                            <li class="">
                              <a
                                href="#supported-types"
                                data-target="#supported-types"
                                onmouseenter="showTitleIfOverflows(this)"
                                >Supported types</a
                              >
                            </li>
                          </ul>
                        </li>
                        <li class="">
                          <a
                            href="#types-of-rules"
                            data-target="#types-of-rules"
                            onmouseenter="showTitleIfOverflows(this)"
                            >Types of Rules</a
                          >
                          <ul class="nav">
                            <li class="">
                              <a
                                href="#conditions"
                                data-target="#conditions"
                                onmouseenter="showTitleIfOverflows(this)"
                                >Conditions</a
                              >
                            </li>
                            <li class="">
                              <a
                                href="#properties"
                                data-target="#properties"
                                onmouseenter="showTitleIfOverflows(this)"
                                >Properties</a
                              >
                            </li>
                            <li class="">
                              <a
                                href="#variables"
                                data-target="#variables"
                                onmouseenter="showTitleIfOverflows(this)"
                                >Variables</a
                              >
                            </li>
                            <li class="">
                              <a
                                href="#options"
                                data-target="#options"
                                onmouseenter="showTitleIfOverflows(this)"
                                >Options</a
                              >
                            </li>
                            <li class="">
                              <a
                                href="#functions"
                                data-target="#functions"
                                onmouseenter="showTitleIfOverflows(this)"
                                >Functions</a
                              >
                            </li>
                            <li class="">
                              <a
                                href="#block-functions"
                                data-target="#block-functions"
                                onmouseenter="showTitleIfOverflows(this)"
                                >Block Functions</a
                              >
                            </li>
                            <li class="">
                              <a
                                href="#include"
                                data-target="#include"
                                onmouseenter="showTitleIfOverflows(this)"
                                >Include</a
                              >
                            </li>
                            <li class="">
                              <a
                                href="#special-variables-and"
                                data-target="#special-variables-and"
                                onmouseenter="showTitleIfOverflows(this)"
                                >Special variables
                              </a>
                            </li>
                          </ul>
                        </li>
                        <li class="">
                          <a
                            href="#extended-xpath"
                            data-target="#extended-xpath"
                            onmouseenter="showTitleIfOverflows(this)"
                            >Extended XPath</a
                          >
                          <ul class="nav">
                            <li class="">
                              <a
                                href="#context"
                                data-target="#context"
                                onmouseenter="showTitleIfOverflows(this)"
                                >Context</a
                              >
                            </li>
                            <li>
                              <a
                                href="#zeroing-in-on-nodes"
                                data-target="#zeroing-in-on-nodes"
                                onmouseenter="showTitleIfOverflows(this)"
                                >Zeroing in on nodes</a
                              >
                            </li>
                            <li>
                              <a
                                href="#has-class"
                                data-target="#has-class"
                                onmouseenter="showTitleIfOverflows(this)"
                                >has-class</a
                              >
                            </li>
                            <li>
                              <a
                                href="#ends-with"
                                data-target="#ends-with"
                                onmouseenter="showTitleIfOverflows(this)"
                                >ends-with</a
                              >
                            </li>
                            <li>
                              <a
                                href="#prev-sibling"
                                data-target="#prev-sibling"
                                onmouseenter="showTitleIfOverflows(this)"
                                >prev-sibling</a
                              >
                            </li>
                            <li>
                              <a
                                href="#next-sibling"
                                data-target="#next-sibling"
                                onmouseenter="showTitleIfOverflows(this)"
                                >next-sibling</a
                              >
                            </li>
                          </ul>
                        </li>
                        <li>
                          <a
                            href="#supported-conditions"
                            data-target="#supported-conditions"
                            onmouseenter="showTitleIfOverflows(this)"
                            >Supported conditions</a
                          >
                          <ul class="nav">
                            <li>
                              <a
                                href="#domain"
                                data-target="#domain"
                                onmouseenter="showTitleIfOverflows(this)"
                                >domain</a
                              >
                            </li>
                            <li>
                              <a
                                href="#domain-not"
                                data-target="#domain-not"
                                onmouseenter="showTitleIfOverflows(this)"
                                >domain_not</a
                              >
                            </li>
                            <li>
                              <a
                                href="#path"
                                data-target="#path"
                                onmouseenter="showTitleIfOverflows(this)"
                                >path</a
                              >
                            </li>
                            <li>
                              <a
                                href="#path-not"
                                data-target="#path-not"
                                onmouseenter="showTitleIfOverflows(this)"
                                >path_not</a
                              >
                            </li>
                            <li>
                              <a
                                href="#exists"
                                data-target="#exists"
                                onmouseenter="showTitleIfOverflows(this)"
                                >exists</a
                              >
                            </li>
                            <li>
                              <a
                                href="#not-exists"
                                data-target="#not-exists"
                                onmouseenter="showTitleIfOverflows(this)"
                                >not_exists</a
                              >
                            </li>
                            <li>
                              <a
                                href="#true"
                                data-target="#true"
                                onmouseenter="showTitleIfOverflows(this)"
                                >true</a
                              >
                            </li>
                            <li>
                              <a
                                href="#false"
                                data-target="#false"
                                onmouseenter="showTitleIfOverflows(this)"
                                >false</a
                              >
                            </li>
                          </ul>
                        </li>
                        <li>
                          <a
                            href="#supported-options"
                            data-target="#supported-options"
                            onmouseenter="showTitleIfOverflows(this)"
                            >Supported options</a
                          >
                          <ul class="nav">
                            <li>
                              <a
                                href="#version"
                                data-target="#version"
                                onmouseenter="showTitleIfOverflows(this)"
                                >version</a
                              >
                            </li>
                            <li>
                              <a
                                href="#allowed-origin-new"
                                data-target="#allowed-origin-new"
                                onmouseenter="showTitleIfOverflows(this)"
                                >allowed_origin
                              </a>
                            </li>
                          </ul>
                        </li>
                        <li>
                          <a
                            href="#supported-functions"
                            data-target="#supported-functions"
                            onmouseenter="showTitleIfOverflows(this)"
                            >Supported functions</a
                          >
                          <ul class="nav">
                            <li>
                              <a
                                href="#debug"
                                data-target="#debug"
                                onmouseenter="showTitleIfOverflows(this)"
                                >debug</a
                              >
                            </li>
                            <li>
                              <a
                                href="#remove"
                                data-target="#remove"
                                onmouseenter="showTitleIfOverflows(this)"
                                >remove</a
                              >
                            </li>
                            <li>
                              <a
                                href="#append"
                                data-target="#append"
                                onmouseenter="showTitleIfOverflows(this)"
                                >append</a
                              >
                            </li>
                            <li>
                              <a
                                href="#prepend"
                                data-target="#prepend"
                                onmouseenter="showTitleIfOverflows(this)"
                                >prepend</a
                              >
                            </li>
                            <li>
                              <a
                                href="#after"
                                data-target="#after"
                                onmouseenter="showTitleIfOverflows(this)"
                                >after</a
                              >
                            </li>
                            <li>
                              <a
                                href="#before"
                                data-target="#before"
                                onmouseenter="showTitleIfOverflows(this)"
                                >before</a
                              >
                            </li>
                            <li>
                              <a
                                href="#append-to"
                                data-target="#append-to"
                                onmouseenter="showTitleIfOverflows(this)"
                                >append_to</a
                              >
                            </li>
                            <li>
                              <a
                                href="#prepend-to"
                                data-target="#prepend-to"
                                onmouseenter="showTitleIfOverflows(this)"
                                >prepend_to</a
                              >
                            </li>
                            <li>
                              <a
                                href="#after-el"
                                data-target="#after-el"
                                onmouseenter="showTitleIfOverflows(this)"
                                >after_el</a
                              >
                            </li>
                            <li>
                              <a
                                href="#before-el"
                                data-target="#before-el"
                                onmouseenter="showTitleIfOverflows(this)"
                                >before_el</a
                              >
                            </li>
                            <li>
                              <a
                                href="#replace-tag"
                                data-target="#replace-tag"
                                onmouseenter="showTitleIfOverflows(this)"
                                >replace_tag</a
                              >
                            </li>
                            <li>
                              <a
                                href="#wrap"
                                data-target="#wrap"
                                onmouseenter="showTitleIfOverflows(this)"
                                >wrap</a
                              >
                            </li>
                            <li>
                              <a
                                href="#wrap-inner"
                                data-target="#wrap-inner"
                                onmouseenter="showTitleIfOverflows(this)"
                                >wrap_inner</a
                              >
                            </li>
                            <li>
                              <a
                                href="#clone"
                                data-target="#clone"
                                onmouseenter="showTitleIfOverflows(this)"
                                >clone</a
                              >
                            </li>
                            <li>
                              <a
                                href="#detach"
                                data-target="#detach"
                                onmouseenter="showTitleIfOverflows(this)"
                                >detach</a
                              >
                            </li>
                            <li>
                              <a
                                href="#split-parent"
                                data-target="#split-parent"
                                onmouseenter="showTitleIfOverflows(this)"
                                >split_parent</a
                              >
                            </li>
                            <li>
                              <a
                                href="#pre"
                                data-target="#pre"
                                onmouseenter="showTitleIfOverflows(this)"
                                >pre</a
                              >
                            </li>
                            <li>
                              <a
                                href="#set-attr"
                                data-target="#set-attr"
                                onmouseenter="showTitleIfOverflows(this)"
                                >set_attr</a
                              >
                            </li>
                            <li>
                              <a
                                href="#set-attrs"
                                data-target="#set-attrs"
                                onmouseenter="showTitleIfOverflows(this)"
                                >set_attrs</a
                              >
                            </li>
                            <li>
                              <a
                                href="#match"
                                data-target="#match"
                                onmouseenter="showTitleIfOverflows(this)"
                                >match</a
                              >
                            </li>
                            <li>
                              <a
                                href="#replace"
                                data-target="#replace"
                                onmouseenter="showTitleIfOverflows(this)"
                                >replace</a
                              >
                            </li>
                            <li>
                              <a
                                href="#urlencode"
                                data-target="#urlencode"
                                onmouseenter="showTitleIfOverflows(this)"
                                >urlencode</a
                              >
                            </li>
                            <li>
                              <a
                                href="#urldecode"
                                data-target="#urldecode"
                                onmouseenter="showTitleIfOverflows(this)"
                                >urldecode</a
                              >
                            </li>
                            <li>
                              <a
                                href="#htmlencode"
                                data-target="#htmlencode"
                                onmouseenter="showTitleIfOverflows(this)"
                                >htmlencode</a
                              >
                            </li>
                            <li>
                              <a
                                href="#htmldecode"
                                data-target="#htmldecode"
                                onmouseenter="showTitleIfOverflows(this)"
                                >htmldecode</a
                              >
                            </li>
                            <li>
                              <a
                                href="#style-to-attrs"
                                data-target="#style-to-attrs"
                                onmouseenter="showTitleIfOverflows(this)"
                                >style_to_attrs</a
                              >
                            </li>
                            <li>
                              <a
                                href="#background-to-image"
                                data-target="#background-to-image"
                                onmouseenter="showTitleIfOverflows(this)"
                                >background_to_image</a
                              >
                            </li>
                            <li>
                              <a
                                href="#json-to-xml"
                                data-target="#json-to-xml"
                                onmouseenter="showTitleIfOverflows(this)"
                                >json_to_xml</a
                              >
                            </li>
                            <li>
                              <a
                                href="#html-to-dom"
                                data-target="#html-to-dom"
                                onmouseenter="showTitleIfOverflows(this)"
                                >html_to_dom</a
                              >
                            </li>
                            <li>
                              <a
                                href="#combine"
                                data-target="#combine"
                                onmouseenter="showTitleIfOverflows(this)"
                                >combine</a
                              >
                            </li>
                            <li>
                              <a
                                href="#datetime"
                                data-target="#datetime"
                                onmouseenter="showTitleIfOverflows(this)"
                                >datetime</a
                              >
                            </li>
                            <li>
                              <a
                                href="#simplify"
                                data-target="#simplify"
                                onmouseenter="showTitleIfOverflows(this)"
                                >simplify</a
                              >
                            </li>
                            <li>
                              <a
                                href="#inline"
                                data-target="#inline"
                                onmouseenter="showTitleIfOverflows(this)"
                                >inline</a
                              >
                            </li>
                            <li>
                              <a
                                href="#load-new"
                                data-target="#load-new"
                                onmouseenter="showTitleIfOverflows(this)"
                                >load
                              </a>
                            </li>
                            <li>
                              <a
                                href="#unsupported"
                                data-target="#unsupported"
                                onmouseenter="showTitleIfOverflows(this)"
                                >unsupported</a
                              >
                            </li>
                          </ul>
                        </li>
                        <li>
                          <a
                            href="#supported-block-functions"
                            data-target="#supported-block-functions"
                            onmouseenter="showTitleIfOverflows(this)"
                            >Supported block functions</a
                          >
                          <ul class="nav">
                            <li>
                              <a
                                href="#if"
                                data-target="#if"
                                onmouseenter="showTitleIfOverflows(this)"
                                >if</a
                              >
                            </li>
                            <li>
                              <a
                                href="#if-not"
                                data-target="#if-not"
                                onmouseenter="showTitleIfOverflows(this)"
                                >if_not</a
                              >
                            </li>
                            <li>
                              <a
                                href="#map"
                                data-target="#map"
                                onmouseenter="showTitleIfOverflows(this)"
                                >map</a
                              >
                            </li>
                            <li>
                              <a
                                href="#repeat"
                                data-target="#repeat"
                                onmouseenter="showTitleIfOverflows(this)"
                                >repeat</a
                              >
                            </li>
                            <li>
                              <a
                                href="#while"
                                data-target="#while"
                                onmouseenter="showTitleIfOverflows(this)"
                                >while</a
                              >
                            </li>
                            <li>
                              <a
                                href="#while-not"
                                data-target="#while-not"
                                onmouseenter="showTitleIfOverflows(this)"
                                >while_not</a
                              >
                            </li>
                          </ul>
                        </li>
                        <li>
                          <a
                            href="#embedded-elements"
                            data-target="#embedded-elements"
                            onmouseenter="showTitleIfOverflows(this)"
                            >Embedded elements</a
                          >
                        </li>
                        <li>
                          <a
                            href="#processing-pages"
                            data-target="#processing-pages"
                            onmouseenter="showTitleIfOverflows(this)"
                            >Processing pages</a
                          >
                          <ul class="nav">
                            <li>
                              <a
                                href="#working-with-subdomains"
                                data-target="#working-with-subdomains"
                                onmouseenter="showTitleIfOverflows(this)"
                                >Working with subdomains</a
                              >
                            </li>
                          </ul>
                        </li>
                      </ul>
                    </div>
                  </div>
                </div>
              </li>
            </ul>
            <div class="nav-footer">
              <a class="logged-link" href="/auth/logout?to=docs">Logout</a>
              <span class="logged">
                <span class="logged-label">Logged in as</span>
                <span class="logged-name">ޔަޙްޔާގެބައްޕަ</span>
              </span>
            </div>
          </section>
        </div>
        <div class="col-sm-9 col-sm-pull-3 col-lg-7 col-lg-pull-3">
          <div class="content">
            <div id="dev_page_content_wrap" class=" ">
              <div class="dev_page_bread_crumbs"></div>
              <h1 id="dev_page_title" dir="auto">
                Instant Views and Where to Find Them
              </h1>

              <div id="dev_page_content" dir="auto">
                <!-- scroll_nav -->

                <p>
                  This document describes Telegram's Instant View format in
                  <strong>stupefying detail</strong>. If this is your first time
                  hearing about Instant View, please check out our
                  <a href="/"><strong>Introduction</strong></a> and
                  <a href="/samples/"><strong>Sample Templates</strong></a>
                  before you dive in.
                </p>
                <p>
                  If you're comfortable with the idea of Instant View templates,
                  let's look at what makes them tick. To begin with, this is our
                  in-house artist's idea of how Instant View pages are
                  generated:
                </p>
                <div>
                  <a
                    href="/file/811140069/3/HNOgxR07ql4.872234/f83bfd30da8845e186"
                    target="_blank"
                    ><img
                      src="/file/811140938/2/FF1p2pxErHM.79819/a582b1940327a15468"
                      title="How Instant View Pages are made, click for hi-res version"
                      class="dev_page_image"
                  /></a>
                </div>

                <p>
                  It turns out, he is not entirely wrong. This is how Instant
                  View pages are <strong>really</strong> generated:
                </p>
                <ol>
                  <li>
                    Whenever Telegram needs to display a link preview for a URL,
                    it also checks whether an
                    <strong>Instant View template</strong> exists for that
                    domain.
                  </li>
                  <li>
                    If a template exists, our Instant View Bot obtains the page
                    using the URL (it only processes pages that have the
                    MIME-type <code>text/html</code>).
                  </li>
                  <li>
                    The bot then applies <strong>rules</strong> from the
                    template that determine the positioning of the key elements
                    on the source page (using
                    <a href="https://www.w3.org/TR/xpath/">XPath 1.0</a>
                    expressions) and modifies the page content to fit the
                    <strong>Instant View format</strong>.
                  </li>
                  <li>
                    The edited page is used to create a new
                    <strong>Instant View page</strong> that will be displayed to
                    the user.
                  </li>
                </ol>
                <p>
                  This document will explore the
                  <a href="#instant-view-format">Instant View Format</a>, the
                  <a href="#types-of-rules">Types of Rules</a> your template can
                  utilize, as well as some useful
                  <a href="#extended-xpath">XPath constructs</a>,
                  <a href="#supported-conditions">conditions</a>, and
                  <a href="#supported-functions">functions</a> that may help you
                  build better templates.
                </p>
                <p>
                  This manual was intended to be used as a reference, so you
                  don't have to read the entire thing to get started. Our
                  <a href="/samples">sample templates</a> make for a much better
                  entry point. You can check back here whenever something is not
                  clear.
                </p>
                <h3>
                  <a class="anchor-link" href="#recent-changes"
                    ><i class="anchor-icon"></i></a
                  ><a
                    class="anchor"
                    name="recent-changes"
                    id="recent-changes"
                  ></a
                  >Recent changes
                </h3>
                <h4>
                  <a class="anchor-link" href="#september-10-2020"
                    ><i class="anchor-icon"></i></a
                  ><a
                    class="anchor"
                    name="september-10-2020"
                    id="september-10-2020"
                  ></a
                  >September 10, 2020
                </h4>
                <ul>
                  <li>
                    Added the new
                    <a href="#allowed-origin-new">~allowed_origin</a> option
                  </li>
                  <li>Added the new <a href="#load-new">@load</a> function</li>
                  <li>
                    The <a href="#inline">@inline</a> function now supports the
                    <code>silent</code> parameter which ignores errors while
                    fetching a page
                  </li>
                </ul>
                <h4>
                  <a class="anchor-link" href="#march-20-2019"
                    ><i class="anchor-icon"></i></a
                  ><a class="anchor" name="march-20-2019" id="march-20-2019"></a
                  >March 20, 2019
                </h4>
                <p><strong>Version 2.1</strong></p>
                <ul>
                  <li>
                    Supported the <code>srcset</code> attribute in
                    <strong>Image</strong> and <strong>Icon</strong> types. The
                    IV engine will automatically take the highest image
                    resolution available (but not higher than 2560px).
                  </li>
                  <li>
                    The <a href="#match">@match</a> function now returns only
                    nodes which content was matched by regular expression
                  </li>
                  <li>
                    The <a href="#replace">@replace</a> function now returns
                    only nodes which content was replaced by regular expression
                  </li>
                  <li>
                    The <a href="#inline">@inline</a> function no longer follows
                    canonical redirect links while fetching a page
                  </li>
                </ul>
                <p><strong>Also in this update:</strong></p>
                <ul>
                  <li>
                    Added the new
                    <a href="#split-parent">@split_parent</a> function
                  </li>
                </ul>
                <h4>
                  <a class="anchor-link" href="#december-10-2018"
                    ><i class="anchor-icon"></i></a
                  ><a
                    class="anchor"
                    name="december-10-2018"
                    id="december-10-2018"
                  ></a
                  >December 10, 2018
                </h4>
                <p>
                  <strong>Instant View 2.0</strong> expands the platform with
                  support for right-to-left languages, new page blocks, useful
                  functions and much more. We recommend using the latest version
                  in your templates. To do this, add the following rule
                  <strong>at the beginning</strong> of the template:
                </p>
                <pre
                  class="cm-s-default"
                ><span class="cm-keyword">~version</span>: <span class="cm-string">"2.0"</span></pre>
                <p>Below is a list of changes in version 2.0:</p>
                <p>New <a href="#properties">properties</a>:</p>
                <ul>
                  <li>kicker</li>
                  <li>site_name</li>
                </ul>
                <p>New <a href="#supported-types">types</a>:</p>
                <ul>
                  <li>Map</li>
                  <li>Table</li>
                  <li>Details</li>
                  <li>RelatedArticles</li>
                  <li>Marked</li>
                  <li>Subscript</li>
                  <li>Superscript</li>
                  <li>Icon</li>
                  <li>PhoneLink</li>
                  <li>Reference</li>
                </ul>
                <p>New <a href="#types-of-rules">types of rules</a>:</p>
                <ul>
                  <li><a href="#options">Options</a></li>
                  <li><a href="#block-functions">Block functions</a></li>
                </ul>
                <p>New <a href="#supported-functions">functions</a>:</p>
                <ul>
                  <li><a href="#wrap-inner">wrap_inner</a></li>
                  <li><a href="#style-to-attrs">style_to_attrs</a></li>
                </ul>
                <p>Other features and improvements:</p>
                <ul>
                  <li>
                    Xpath query results can be appended into variables using
                    <code>+</code> (<a href="#variables">see more</a>)
                  </li>
                  <li>New XPath function <a href="#ends-with">ends-with</a></li>
                  <li>
                    Lists can contain block elements such as paragraph, nested
                    lists, tables and so on
                  </li>
                  <li>
                    Support for attribution in media captions (<code
                      >&lt;cite&gt;</code
                    >
                    tag)
                  </li>
                  <li>
                    Support for image links (<code>href</code> attribute for the
                    Image type)
                  </li>
                  <li>
                    Unsupported elements (such as an image inside the
                    blockquote) now generate an error instead of moving up
                  </li>
                  <li>
                    Improved <code>@simplify</code> function for better
                    processing RichText (e.g. saves line breaks formed by block
                    elements)
                  </li>
                </ul>
                <h3>
                  <a class="anchor-link" href="#instant-view-format"
                    ><i class="anchor-icon"></i></a
                  ><a
                    class="anchor"
                    name="instant-view-format"
                    id="instant-view-format"
                  ></a
                  >Instant View Format
                </h3>
                <p>
                  An Instant View page is an object with the following
                  <a href="#properties"><strong>properties</strong></a
                  >:
                </p>
                <table class="table">
                  <thead>
                    <tr>
                      <th>Parameter</th>
                      <th>Type</th>
                      <th>Description</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td><strong>title</strong> <em>Required</em></td>
                      <td>RichText</td>
                      <td>Page title</td>
                    </tr>
                    <tr>
                      <td><strong>subtitle</strong></td>
                      <td>RichText</td>
                      <td>Page subtitle</td>
                    </tr>
                    <tr>
                      <td><strong>kicker</strong>&nbsp;</td>
                      <td>RichText</td>
                      <td>Kicker</td>
                    </tr>
                    <tr>
                      <td><strong>author</strong></td>
                      <td>String</td>
                      <td>Author name</td>
                    </tr>
                    <tr>
                      <td><strong>author_url</strong></td>
                      <td>Url</td>
                      <td>Author link</td>
                    </tr>
                    <tr>
                      <td><strong>published_date</strong></td>
                      <td>Unixtime</td>
                      <td>Date published</td>
                    </tr>
                    <tr>
                      <td><strong>description</strong></td>
                      <td>String</td>
                      <td>A short description (used in link preview)</td>
                    </tr>
                    <tr>
                      <td><strong>image_url</strong></td>
                      <td>Url</td>
                      <td>Link preview photo (used in link preview)</td>
                    </tr>
                    <tr>
                      <td><strong>document_url</strong></td>
                      <td>Url</td>
                      <td>Link preview document (used in link preview)</td>
                    </tr>
                    <tr>
                      <td><strong>site_name</strong>&nbsp;</td>
                      <td>String</td>
                      <td>Name of website (used in link preview)</td>
                    </tr>
                    <tr>
                      <td><strong>channel</strong></td>
                      <td>String</td>
                      <td>
                        The username of the article author's (or the originating
                        website's)
                        <a href="https://telegram.org/blog/channels">channel</a>
                        on Telegram in the format <code>@username</code>
                      </td>
                    </tr>
                    <tr>
                      <td><strong>cover</strong></td>
                      <td>Media (Image/Video/Embed/Map)</td>
                      <td>Page cover</td>
                    </tr>
                    <tr>
                      <td><strong>body</strong> <em>Required</em></td>
                      <td>Article</td>
                      <td>Page content</td>
                    </tr>
                  </tbody>
                </table>
                <h4>
                  <a class="anchor-link" href="#rtl-support"
                    ><i class="anchor-icon"></i></a
                  ><a class="anchor" name="rtl-support" id="rtl-support"></a>RTL
                  support
                </h4>
                <p>
                  The platform supports right-to-left languages. If
                  <code>&lt;html&gt;</code> tag or tag referenced by body
                  property has the attribute <code>dir="rtl"</code>, the page
                  will be marked as RTL. In case this attribute is not set, you
                  can set it manually to display the page in Instant View as RTL
                  using the following rule:
                </p>
                <pre
                  class="cm-s-default"
                >  <span class="cm-builtin">@set_attr</span>(<span class="cm-variable">dir</span>, <span class="cm-string">"rtl"</span>): <span class="cm-variable-2">$body</span>   <span class="cm-comment"># if body is already defined</span>
  <span class="cm-builtin">@set_attr</span>(<span class="cm-variable">dir</span>, <span class="cm-string">"rtl"</span>): /<span class="cm-tag-2">html</span>   <span class="cm-comment"># alternative way</span></pre>
                <h4>
                  <a class="anchor-link" href="#supported-types"
                    ><i class="anchor-icon"></i></a
                  ><a
                    class="anchor"
                    name="supported-types"
                    id="supported-types"
                  ></a
                  >Supported types
                </h4>
                <p>
                  The IV page object can hold the following
                  <strong>types</strong>:
                </p>
                <table class="table">
                  <thead>
                    <tr>
                      <th>Type</th>
                      <th>Allowed&nbsp;children</th>
                      <th>Description</th>
                      <th>HTML counterpart</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td><strong>Article</strong></td>
                      <td>
                        Header<br />
                        Subheader<br />
                        Paragraph<br />
                        Preformatted<br />
                        Divider<br />
                        Anchor<br />
                        List<br />
                        Blockquote<br />
                        Pullquote<br />
                        Media<br />
                        Image<br />
                        Video<br />
                        Audio<br />
                        Embed<br />
                        Slideshow<br />
                        Table<br />
                        Details<br />
                        Footer<br />
                        RelatedArticles
                      </td>
                      <td>Page content</td>
                      <td><code>&lt;article&gt;</code></td>
                    </tr>
                    <tr>
                      <td><strong>Header</strong></td>
                      <td>RichText</td>
                      <td>Major heading</td>
                      <td>
                        We use the top-level of the <code>&lt;h1&gt;</code> –
                        <code>&lt;h4&gt;</code> headings found on the source
                        page
                      </td>
                    </tr>
                    <tr>
                      <td><strong>Subheader</strong></td>
                      <td>RichText</td>
                      <td>Minor heading</td>
                      <td>
                        We use the remaining headings <code>&lt;h1&gt;</code> –
                        <code>&lt;h4&gt;</code> as well as
                        <code>&lt;h5&gt;</code> –
                        <code>&lt;h6&gt;</code> headings
                      </td>
                    </tr>
                    <tr>
                      <td><strong>Paragraph</strong></td>
                      <td>RichText</td>
                      <td>A paragraph</td>
                      <td><code>&lt;p&gt;</code></td>
                    </tr>
                    <tr>
                      <td><strong>Preformatted</strong></td>
                      <td>RichText</td>
                      <td>Preformatted text</td>
                      <td>
                        <code>&lt;pre&gt;</code> with the optional attribute
                        <code>data-language</code
                        ><a href="#note-on-code-languages">*</a>
                      </td>
                    </tr>
                    <tr>
                      <td><strong>Anchor</strong></td>
                      <td>–</td>
                      <td>Anchor</td>
                      <td>
                        <code>&lt;anchor&gt;</code> with the attribute
                        <code>name</code> that contains the anchor name
                      </td>
                    </tr>
                    <tr>
                      <td><strong>Divider</strong></td>
                      <td>–</td>
                      <td>A separator</td>
                      <td><code>&lt;hr&gt;</code></td>
                    </tr>
                    <tr>
                      <td><strong>List</strong></td>
                      <td>ListItem</td>
                      <td>A list</td>
                      <td>
                        <code>&lt;ul&gt;</code> for a bullet list,
                        <code>&lt;ol&gt;</code> for a numbered list
                      </td>
                    </tr>
                    <tr>
                      <td><strong>ListItem</strong></td>
                      <td>
                        <em>version 1.0:</em><br />
                        RichText<br /><br />
                        <em>version 2.0:</em><br />
                        Header<br />
                        Subheader<br />
                        Paragraph<br />
                        Preformatted<br />
                        Divider<br />
                        Anchor<br />
                        List<br />
                        Blockquote<br />
                        Pullquote<br />
                        Media<br />
                        Image<br />
                        Video<br />
                        Audio<br />
                        Embed<br />
                        Slideshow<br />
                        Table<br />
                        Details
                      </td>
                      <td>A list item</td>
                      <td><code>&lt;li&gt;</code></td>
                    </tr>
                    <tr>
                      <td><strong>Blockquote</strong></td>
                      <td>
                        RichText<br />
                        QuoteCaption
                      </td>
                      <td>A block quote</td>
                      <td><code>&lt;blockquote&gt;</code></td>
                    </tr>
                    <tr>
                      <td><strong>Pullquote</strong></td>
                      <td>
                        RichText<br />
                        QuoteCaption
                      </td>
                      <td>A pull quote</td>
                      <td><code>&lt;aside&gt;</code></td>
                    </tr>
                    <tr>
                      <td><strong>QuoteCaption</strong></td>
                      <td>RichText</td>
                      <td>Caption of a quote</td>
                      <td><code>&lt;cite&gt;</code></td>
                    </tr>
                    <tr>
                      <td><strong>Media</strong></td>
                      <td>
                        Image<br />
                        Video<br />
                        Audio<br />
                        Embed<br />
                        Map<br />
                        MediaCaption
                      </td>
                      <td>Media content</td>
                      <td><code>&lt;figure&gt;</code></td>
                    </tr>
                    <tr>
                      <td><strong>Image</strong></td>
                      <td>–</td>
                      <td>An image</td>
                      <td>
                        <code>&lt;img&gt;</code> with the attribute
                        <code>src</code> and the optional attribute
                        <code>href</code> to make the image clickable. Allowed
                        formats: GIF, JPG, PNG (GIF would be converted into
                        Video type by IV)<br />As of
                        <a href="#march-20-2019">version 2.1</a>, supports the
                        attribute <code>srcset</code> (<code>srcset</code> has
                        higher priority than <code>src</code>, the same as in a
                        browser; IV gets the highest available resolution under
                        2560px).
                      </td>
                    </tr>
                    <tr>
                      <td><strong>Video</strong></td>
                      <td>–</td>
                      <td>A video</td>
                      <td>
                        <code>&lt;video&gt;</code> with the attribute
                        <code>src</code>, or containing the tag
                        <code>&lt;source type="video/mp4"&gt;</code> with the
                        attribute <code>src</code>
                      </td>
                    </tr>
                    <tr>
                      <td><strong>Audio</strong></td>
                      <td>–</td>
                      <td>An audio</td>
                      <td>
                        <code>&lt;audio&gt;</code> with the attribute
                        <code>src</code>, or containing the tag
                        <code>&lt;source&gt;</code> with the attribute
                        <code>src</code> and the attribute
                        <code>type</code> (possible types:
                        <code>audio/ogg</code>, <code>audio/mpeg</code>,
                        <code>audio/mp4</code>)
                      </td>
                    </tr>
                    <tr>
                      <td><strong>Embed</strong></td>
                      <td>–</td>
                      <td>An embedded element</td>
                      <td>
                        <code>&lt;iframe&gt;</code> with the attribute
                        <code>src</code>.
                        <a href="#embedded-elements"
                          >List of supported embeds</a
                        >
                      </td>
                    </tr>
                    <tr>
                      <td><strong>Map</strong>&nbsp;</td>
                      <td>–</td>
                      <td>A map</td>
                      <td>
                        <code>&lt;img&gt;</code> or
                        <code>&lt;iframe&gt;</code> with the attribute
                        <code>src</code> referring to Google or Yandex maps
                      </td>
                    </tr>
                    <tr>
                      <td><strong>Slideshow</strong></td>
                      <td>
                        Media (Image/Video)<br />
                        Image<br />
                        Video<br />
                        MediaCaption
                      </td>
                      <td>A slideshow</td>
                      <td><code>&lt;slideshow&gt;</code></td>
                    </tr>
                    <tr>
                      <td><strong>MediaCaption</strong></td>
                      <td>RichText</td>
                      <td>Media caption</td>
                      <td>
                        <code>&lt;figcaption&gt;</code><br />
                        As of IV 2.0, can contain an additional tag
                        <code>&lt;cite&gt;</code> with attribution (author,
                        creator or source of the media)
                      </td>
                    </tr>
                    <tr>
                      <td><strong>Table</strong>&nbsp;</td>
                      <td>
                        TableCaption<br />
                        TableRow
                      </td>
                      <td>A table</td>
                      <td><code>&lt;table&gt;</code></td>
                    </tr>
                    <tr>
                      <td><strong>TableCaption</strong>&nbsp;</td>
                      <td>RichText</td>
                      <td>A table caption</td>
                      <td><code>&lt;caption&gt;</code></td>
                    </tr>
                    <tr>
                      <td><strong>TableRow</strong>&nbsp;</td>
                      <td>TableCell</td>
                      <td>A table row</td>
                      <td>
                        <code>&lt;tr&gt;</code> with the optional attributes
                        <code>align</code>, <code>valign</code>, can be wrapped
                        with <code>&lt;thead&gt;</code> or
                        <code>&lt;tbody&gt;</code> or
                        <code>&lt;tfoot&gt;</code> with the optional attributes
                        <code>align</code>, <code>valign</code>
                      </td>
                    </tr>
                    <tr>
                      <td><strong>TableCell</strong>&nbsp;</td>
                      <td>RichText</td>
                      <td>A table cell</td>
                      <td>
                        <code>&lt;td&gt;</code> for a standard cell,
                        <code>&lt;th&gt;</code> for a header cell, with the
                        optional attributes <code>align</code>,
                        <code>valign</code>, <code>colspan</code>,
                        <code>rowspan</code>
                      </td>
                    </tr>
                    <tr>
                      <td>
                        <strong>Details</strong>&nbsp;<br />
                        <em>(version 2.0+)</em>
                      </td>
                      <td>
                        DetailsHeader<br />
                        Header<br />
                        Subheader<br />
                        Paragraph<br />
                        Preformatted<br />
                        Divider<br />
                        Anchor<br />
                        List<br />
                        Blockquote<br />
                        Pullquote<br />
                        Media<br />
                        Image<br />
                        Video<br />
                        Audio<br />
                        Embed<br />
                        Slideshow<br />
                        Table<br />
                        Details
                      </td>
                      <td>A collapsible block</td>
                      <td>
                        <code>&lt;details&gt;</code> with the optional attribute
                        <code>open</code> to be opened by default
                      </td>
                    </tr>
                    <tr>
                      <td>
                        <strong>DetailsHeader</strong>&nbsp;<br />
                        <em>(version 2.0+)</em>
                      </td>
                      <td>RichText</td>
                      <td>A visible heading for the collapsible block</td>
                      <td><code>&lt;summary&gt;</code></td>
                    </tr>
                    <tr>
                      <td><strong>RelatedArticles</strong>&nbsp;</td>
                      <td>
                        Header<br />
                        Link
                      </td>
                      <td>Related articles</td>
                      <td>
                        <code>&lt;related&gt;</code> containing one of
                        <code>&lt;h1&gt;</code> – <code>&lt;h6&gt;</code> tag as
                        header of the block and <code>&lt;a&gt;</code> tags with
                        the attribute <code>href</code> containing a URL of
                        related article. <strong>Note:</strong> Only articles
                        that have an IV will appear in this block on the IV
                        page.
                      </td>
                    </tr>
                    <tr>
                      <td><strong>Footer</strong></td>
                      <td>RichText</td>
                      <td>The footer</td>
                      <td><code>&lt;footer&gt;</code></td>
                    </tr>
                    <tr>
                      <td><strong>RichText</strong></td>
                      <td>
                        Bold<br />
                        Italic<br />
                        Underline<br />
                        Strike<br />
                        Fixed<br />
                        Marked<br />
                        Subscript<br />
                        Superscript<br />
                        Icon<br />
                        Link<br />
                        EmailLink<br />
                        PhoneLink<br />
                        LineBreak<br />
                        Anchor<br />
                        Reference<br />
                        String
                      </td>
                      <td>Formatted text</td>
                      <td>Text elements and supported tags</td>
                    </tr>
                    <tr>
                      <td><strong>Bold</strong></td>
                      <td>RichText</td>
                      <td>Bold text</td>
                      <td>
                        <code>&lt;b&gt;</code> or <code>&lt;strong&gt;</code>
                      </td>
                    </tr>
                    <tr>
                      <td><strong>Italic</strong></td>
                      <td>RichText</td>
                      <td>Italic text</td>
                      <td><code>&lt;i&gt;</code> or <code>&lt;em&gt;</code></td>
                    </tr>
                    <tr>
                      <td><strong>Underline</strong></td>
                      <td>RichText</td>
                      <td>Underlined text</td>
                      <td>
                        <code>&lt;u&gt;</code> or <code>&lt;ins&gt;</code>
                      </td>
                    </tr>
                    <tr>
                      <td><strong>Strike</strong></td>
                      <td>RichText</td>
                      <td>Strikethrough text</td>
                      <td>
                        <code>&lt;s&gt;</code> or <code>&lt;del&gt;</code> or
                        <code>&lt;strike&gt;</code>
                      </td>
                    </tr>
                    <tr>
                      <td><strong>Fixed</strong></td>
                      <td>RichText</td>
                      <td>Monospace text</td>
                      <td>
                        <code>&lt;code&gt;</code> or <code>&lt;kbd&gt;</code> or
                        <code>&lt;samp&gt;</code> or <code>&lt;tt&gt;</code>
                      </td>
                    </tr>
                    <tr>
                      <td><strong>Marked</strong>&nbsp;</td>
                      <td>RichText</td>
                      <td>Marked text</td>
                      <td><code>&lt;mark&gt;</code></td>
                    </tr>
                    <tr>
                      <td><strong>Subscript</strong>&nbsp;</td>
                      <td>RichText</td>
                      <td>Subscript text</td>
                      <td><code>&lt;sub&gt;</code></td>
                    </tr>
                    <tr>
                      <td><strong>Superscript</strong>&nbsp;</td>
                      <td>RichText</td>
                      <td>Superscript text</td>
                      <td><code>&lt;sup&gt;</code></td>
                    </tr>
                    <tr>
                      <td><strong>Icon</strong>&nbsp;</td>
                      <td>–</td>
                      <td>A small image inside the text</td>
                      <td>
                        <code>&lt;pic&gt;</code> with the attribute
                        <code>src</code>, <code>width</code>,
                        <code>height</code>. Can contain the attribute
                        <code>optional</code> if the image is not important and
                        may be ignored. Allowed formats: JPG, PNG.<br />As of
                        <a href="#march-20-2019">version 2.1</a>, supports the
                        attribute <code>srcset</code> (<code>srcset</code> has
                        higher priority than <code>src</code>, the same as in a
                        browser).
                      </td>
                    </tr>
                    <tr>
                      <td><strong>Link</strong></td>
                      <td>RichText</td>
                      <td>A link</td>
                      <td>
                        <code>&lt;a&gt;</code> with the attribute
                        <code>href</code> containing a URL
                      </td>
                    </tr>
                    <tr>
                      <td><strong>EmailLink</strong></td>
                      <td>RichText</td>
                      <td>A link to an email address</td>
                      <td>
                        <code>&lt;a&gt;</code> with the attribute
                        <code>href</code> containing a <code>mailto:</code> link
                      </td>
                    </tr>
                    <tr>
                      <td><strong>PhoneLink</strong>&nbsp;</td>
                      <td>RichText</td>
                      <td>A link to a phone number</td>
                      <td>
                        <code>&lt;a&gt;</code> with the attribute
                        <code>href</code> containing a <code>tel:</code> link
                      </td>
                    </tr>
                    <tr>
                      <td><strong>Reference</strong>&nbsp;</td>
                      <td>RichText</td>
                      <td>A reference</td>
                      <td>
                        <code>&lt;reference&gt;</code> with the attribute
                        <code>name</code> that contains the reference name
                      </td>
                    </tr>
                    <tr>
                      <td><strong>LineBreak</strong></td>
                      <td>–</td>
                      <td>Line break</td>
                      <td><code>&lt;br&gt;</code></td>
                    </tr>
                  </tbody>
                </table>
                <h5>
                  <a class="anchor-link" href="#note-on-code-languages"
                    ><i class="anchor-icon"></i></a
                  ><a class="anchor" name="note-on-code-languages"></a>Note on
                  code languages
                </h5>
                <p>
                  Telegram apps currently do not support code highlighting, but
                  they will in the future. For this reason, it is advisable to
                  include the code language attribute
                  (<code>data-language</code>) for large
                  <code>&lt;pre&gt;</code> blocks if it is supplied in the
                  source.
                </p>
                <hr />
                <h3>
                  <a class="anchor-link" href="#types-of-rules"
                    ><i class="anchor-icon"></i></a
                  ><a
                    class="anchor"
                    name="types-of-rules"
                    id="types-of-rules"
                  ></a
                  >Types of Rules
                </h3>
                <p>
                  Instant View rules are instructions that tell our IV bot where
                  to find the meta-elements on the source page and how it should
                  modify the content of the page when an Instant View page is
                  created.
                </p>
                <p>
                  Each new line in a template describes a new rule. When the bot
                  renders a page into the Instant View format, it applies rules
                  from the relevant template one after another and ignores any
                  empty lines. You can leave comments by starting a line with
                  <code>#</code>, all following text on that line will be
                  ignored unless enclosed in quote marks. You can use the
                  <code>\</code> symbol to carry a rule over to the next string,
                  like this:
                </p>
                <pre
                  class="cm-s-default"
                ><span class="cm-comment"># Comment </span>
<span class="cm-comment"># You can break up </span><span class="cm-hr">\</span>
<span class="cm-comment">  a long rule into </span><span class="cm-hr">\</span>
<span class="cm-comment">  multiple strings</span></pre>
                <p>
                  Most rules are based on
                  <a href="https://www.w3.org/TR/xpath/">XPath 1.0</a>
                  expressions used to locate the required nodes on the source
                  page.
                </p>
                <p>
                  A block of rules may have a name. In this case, it can be
                  reused in other rules.
                </p>
                <p>We support the following types of rules:</p>
                <h4>
                  <a class="anchor-link" href="#conditions"
                    ><i class="anchor-icon"></i></a
                  ><a class="anchor" name="conditions" id="conditions"></a
                  >Conditions
                </h4>
                <p>
                  Conditions offer unlimited flexibility for your templates.
                  Rules of this type begin with the symbols <code>?</code> or
                  <code>!</code> and use the following format:
                </p>
                <pre
                  class="cm-s-default"
                ><span class="cm-def">?condition</span>:  <span class="cm-variable">xpath_query</span>   <span class="cm-comment"># condition example</span>
<span class="cm-def">!condition</span>:  <span class="cm-variable">regexp</span>        <span class="cm-comment"># parameter on the right depends on the type of the condition</span>
<span class="cm-def">?condition</span>                 <span class="cm-comment"># some conditions don't have parameters</span></pre>
                <p>
                  Groups of conditions that immediately follow one another are
                  interpreted as a block. <code>?</code>-rules follow the OR
                  logic when joined, while <code>!</code>-rules follow the AND
                  logic. This means that for the bot to apply each block, all
                  <code>!</code>-conditions in the block and at least one of the
                  <code>?</code>-conditions within it must be met. This also
                  means that each block must have at least one
                  <code>?</code>-condition.
                </p>
                <p>
                  Blocks of conditions split your rule set into groups. Groups
                  of rules that do not have any conditions are always applied.
                  All other groups are only applied if their conditions are met.
                </p>
                <p><strong>Examples</strong></p>
                <pre
                  class="cm-s-default"
                ><span class="cm-comment"># If a rule is placed here, it will be applied</span>
<span class="cm-comment"># Same with the one here</span>

<span class="cm-def">?false</span>               <span class="cm-comment"># This condition is always false</span>
<span class="cm-comment"># The rule placed here will never be applied, because the condition is not met</span>
<span class="cm-comment"># Very useful indeed</span>

<span class="cm-def">?exists</span>: //<span class="cm-tag-2">article</span>   <span class="cm-comment"># This condition is true if the page has an article tag</span>
<span class="cm-comment"># On these lines, a new group of rules is located, and it will be applied if</span>
<span class="cm-comment"># there's an article tag on the page, despite the ?false condition above</span>

<span class="cm-def">?exists</span>: //<span class="cm-tag-2">article</span>
<span class="cm-def">?exists</span>: //<span class="cm-tag-2">div</span>[<span class="cm-attribute">@id</span>=<span class="cm-string">"article"</span>]
<span class="cm-def">!exists</span>: //<span class="cm-tag-2">meta</span>[<span class="cm-attribute">@property</span>=<span class="cm-string">"og:title"</span>]
<span class="cm-comment"># The rules below this block will be applied if an &lt;article&gt; tag or a</span>
<span class="cm-comment"># &lt;div id="article"&gt; can be found, this tag must also be present: &lt;meta property="og:title"&gt;</span></pre>
                <div><br /></div>

                <blockquote>
                  <p>
                    <a href="#supported-conditions"
                      >Check out the Supported Conditions to see what works out
                      of the box »</a
                    >
                  </p>
                </blockquote>
                <h4>
                  <a class="anchor-link" href="#properties"
                    ><i class="anchor-icon"></i></a
                  ><a class="anchor" name="properties" id="properties"></a
                  >Properties
                </h4>
                <p>
                  Properties are the building blocks for your IV page. Check the
                  <a href="#instant-view-format">Instant View Format</a> for a
                  list of properties that can be used when creating IV pages
                  (you can also define custom properties, but they will not be
                  used anywhere on the resulting IV page). Use this format to
                  fill properties:
                </p>
                <pre
                  class="cm-s-default"
                ><span class="cm-variable-2">property</span>: <span class="cm-variable">xpath_query</span>
<span class="cm-variable-2">property</span>: <span class="cm-string">"Some string"</span>
<span class="cm-variable-2">property</span>: <span class="cm-atom">null</span></pre>
                <p>
                  Properties store the first node that matches the XPath
                  expression <code>xpath_query</code>. By default, if a property
                  already has a value, it will <strong>not</strong> be
                  overwritten. You can change this behavior by adding
                  <code>!</code> to the property name – in this case a new
                  non-empty value can be assigned. If you add <code>!!</code> to
                  the property name, even an empty new value can be assigned to
                  the property.
                </p>
                <p>
                  You can also assign a <code>string</code> to the property
                  instead of the <code>xpath_query</code>. In this case, the
                  property will contain a text element with the specified text.
                  It is also possible to assign <code>null</code> to discard the
                  property's value (will only work with <code>!!</code>).
                </p>
                <p><strong>Examples</strong></p>
                <pre
                  class="cm-s-default"
                ><span class="cm-variable-2">title</span>:   //<span class="cm-tag-2">article</span>//<span class="cm-tag-2">h1</span>      <span class="cm-comment"># Looking for the 'title' in the article heading</span>
<span class="cm-variable-2">title</span>:   //<span class="cm-tag-2">h1</span>               <span class="cm-comment"># If not found, checking for any headings at all</span>
<span class="cm-variable-2">title</span>:   //<span class="cm-tag-2">head</span>/<span class="cm-tag-2">title</span>       <span class="cm-comment"># If no luck either, trying the &lt;title&gt; tag</span>
<span class="cm-def">?path</span>: /blog/.*             <span class="cm-comment"># On pages in the /blog/ section </span>
<span class="cm-variable-2">title</span><span class="cm-positive">!</span>:  //<span class="cm-tag-2">div</span>[<span class="cm-attribute">@id</span>=<span class="cm-string">"title"</span>] <span class="cm-comment"># we prefer to use &lt;div id="title"&gt;, if present</span>
<span class="cm-def">?path</span>: /news/.*             <span class="cm-comment"># On pages in the /news/ section</span>
<span class="cm-variable-2">title</span><span class="cm-positive">!!</span>: //<span class="cm-tag-2">h3</span>               <span class="cm-comment"># title is always in an h3 tag</span>

<span class="cm-variable-2">author</span>:   //<span class="cm-tag-2">article</span>/<span class="cm-attribute">@author</span>  <span class="cm-comment"># Get author name from the author attribute</span>
<span class="cm-def">?exists</span>:  //<span class="cm-tag-2">article</span>[<span class="cm-variable">has-class</span>(<span class="cm-string">"anonymous"</span>)]    
<span class="cm-variable-2">author</span><span class="cm-positive">!!</span>: <span class="cm-atom">null</span>               <span class="cm-comment"># Don't display author for anonymous posts</span></pre>
                <blockquote>
                  <p>
                    <strong>Reminder:</strong> The <em>title</em> and
                    <em>body</em> properties are required for an IV page to be
                    created.
                  </p>
                </blockquote>
                <h4>
                  <a class="anchor-link" href="#variables"
                    ><i class="anchor-icon"></i></a
                  ><a class="anchor" name="variables" id="variables"></a
                  >Variables
                </h4>
                <p>
                  Variables are useful for storing and manipulating nodes before
                  assigning them to <a href="#properties">properties</a> for the
                  final IV page. Variable names begin with the
                  <code>$</code> symbol. Use this format to initialize them:
                </p>
                <pre
                  class="cm-s-default"
                ><span class="cm-variable-2">$variable</span>: <span class="cm-variable">xpath_query</span>
<span class="cm-variable-2">$variable</span>: <span class="cm-string">"Some text"</span>
<span class="cm-variable-2">$variable</span>: <span class="cm-atom">null</span></pre>
                <p>
                  Variables store a list of nodes that match the Xpath
                  expression <code>xpath_query</code>. If a variable is assigned
                  for the second time, its previous value is overwritten. You
                  can change this behavior by adding <code>?</code> to the
                  variable name. You can also append a list of nodes to the
                  previous one by adding <code>+</code> to the variable name.
                </p>
                <p>
                  You can also assign a <code>string</code> to the variable
                  instead of the <code>xpath_query</code>. In this case, the
                  variable will contain a list with one text element that has
                  the specified text. It is also possible to assign
                  <code>null</code> to discard the variable's value.
                </p>
                <p><strong>Examples</strong></p>
                <pre
                  class="cm-s-default"
                ><span class="cm-variable-2">$images</span>:  //<span class="cm-tag-2">img</span>
<span class="cm-variable-2">$images</span>:  //<span class="cm-tag-2">img</span>[<span class="cm-attribute">@src</span>]     <span class="cm-comment"># the previous value will be overwritten</span>
<span class="cm-variable-2">$images</span><span class="cm-positive">?</span>: //<span class="cm-tag-2">article</span>//<span class="cm-tag-2">img</span>  <span class="cm-comment"># a new value will only be assigned if the variable is empty</span>
<span class="cm-variable-2">$medias</span>:  //<span class="cm-tag-2">img</span>
<span class="cm-variable-2">$medias</span><span class="cm-positive">+</span>: //<span class="cm-tag-2">video</span>         <span class="cm-comment"># now $medias contains all img and video tags</span></pre>
                <h4>
                  <a class="anchor-link" href="#options"
                    ><i class="anchor-icon"></i></a
                  ><a class="anchor" name="options" id="options"></a>Options
                </h4>
                <p>
                  Options affect how the page is processed by the bot. Options
                  begin with the <code>~</code> symbol. Use this format to set
                  them:
                </p>
                <pre
                  class="cm-s-default"
                ><span class="cm-keyword">~option</span>: <span class="cm-string">"value"</span>
<span class="cm-keyword">~option</span>: <span class="cm-variable">true</span></pre>
                <p>Options can be set with values in JSON format.</p>
                <p><strong>Examples</strong></p>
                <pre
                  class="cm-s-default"
                ><span class="cm-keyword">~version</span>: <span class="cm-string">"2.1"</span></pre>
                <div><br /></div>

                <blockquote>
                  <p>
                    Check out
                    <a href="#supported-options">Supported Options</a> to see
                    what else works out of the box.
                  </p>
                </blockquote>
                <h4>
                  <a class="anchor-link" href="#functions"
                    ><i class="anchor-icon"></i></a
                  ><a class="anchor" name="functions" id="functions"></a
                  >Functions
                </h4>
                <p>
                  Functions are extremely flexible, but you'll probably mostly
                  use them to strip unnecessary nodes from the page and to
                  replace certain elements with others. Function names begin
                  with the <code>@</code> symbol, you can use the following
                  format:
                </p>
                <pre
                  class="cm-s-default"
                ><span class="cm-builtin">@function</span>:                 <span class="cm-variable">xpath_query</span>   <span class="cm-comment"># a function without parameters</span>
<span class="cm-builtin">@function</span>(<span class="cm-variable">param</span>):          <span class="cm-variable">xpath_query</span>   <span class="cm-comment"># additional parameters are placed in paretheses</span>
<span class="cm-builtin">@function</span>(<span class="cm-variable">p1</span> <span class="cm-variable">p2</span>):          <span class="cm-variable">xpath_query</span>   <span class="cm-comment"># a function with two parameters</span>
<span class="cm-builtin">@function</span>(<span class="cm-variable">p1</span>, <span class="cm-string">"param #2"</span>): <span class="cm-variable">xpath_query</span>   <span class="cm-comment"># parameters can be separated by commas</span>
                                         <span class="cm-comment"># and enclosed in quote marks when needed</span>
<span class="cm-builtin">@function</span>:                 <span class="cm-string">"Some text"</span>   <span class="cm-comment"># use string instead of xpath_query if needed</span></pre>
                <p>
                  The main argument of a function is a list of nodes that match
                  the Xpath expression <code>xpath_query</code>. You can also
                  use a <code>string</code> as the main argument instead of an
                  <code>xpath_query</code>. In this case, the main argument
                  passed to the function will be a list with one text element
                  that has the specified text.
                </p>
                <p><strong>Examples</strong></p>
                <pre
                  class="cm-s-default"
                ><span class="cm-builtin">@remove</span>:            //<span class="cm-tag-2">header</span>               <span class="cm-comment"># removes all &lt;header&gt; tags found on the page</span>
<span class="cm-builtin">@replace_tag</span>(<span class="cm-tag">&lt;h1&gt;</span>): //<span class="cm-tag-2">div</span>[<span class="cm-attribute">@class</span>=<span class="cm-string">"header"</span>] <span class="cm-comment"># replaces all &lt;div class="header"&gt; tags with &lt;h1&gt;</span>
<span class="cm-tag">&lt;h1&gt;</span>:               //<span class="cm-tag-2">div</span>[<span class="cm-attribute">@class</span>=<span class="cm-string">"header"</span>] <span class="cm-comment"># an alias for @replace_tag(&lt;h1&gt;)</span></pre>
                <div><br /></div>

                <p>
                  <strong>Note:</strong> You may find the
                  <a href="#debug">@debug function</a> particularly useful when
                  creating XPath expressions.
                </p>
                <blockquote>
                  <p>
                    Check out
                    <a href="#supported-functions">Supported Functions</a> to
                    see what else works out of the box.
                  </p>
                </blockquote>
                <h4>
                  <a class="anchor-link" href="#block-functions"
                    ><i class="anchor-icon"></i></a
                  ><a
                    class="anchor"
                    name="block-functions"
                    id="block-functions"
                  ></a
                  >Block Functions
                </h4>
                <p>
                  Block functions manipulate blocks of rules. Block function
                  names also begin with the <code>@</code> symbol, you can use
                  the following format:
                </p>
                <pre
                  class="cm-s-default"
                ><span class="cm-builtin">@function</span>(<span class="cm-variable">xpath_query</span>) {   <span class="cm-comment"># opening bracket should be at the end of the line</span>
  <span class="cm-variable-2">$variable</span>: <span class="cm-variable">xpath_query</span>   <span class="cm-comment"># some other rules here</span>
  <span class="cm-builtin">@function</span>: <span class="cm-variable-2">$@</span>            <span class="cm-comment">#   inside the block function</span>
}                          <span class="cm-comment"># closing bracket should be on a separate line</span></pre>
                <p>
                  A block function can contain another block function so they
                  can be nested. Block function can not contain
                  <a href="#conditions">conditions</a>.
                </p>
                <blockquote>
                  <p>
                    Please note that block functions that execute a block of
                    rules several times <strong>(map</strong>,
                    <strong>repeat</strong>, <strong>while</strong>,
                    <strong>while_not)</strong> have a limit on the total number
                    of iterations for the entire template.
                  </p>
                </blockquote>
                <p><strong>Examples</strong></p>
                <pre
                  class="cm-s-default"
                ><span class="cm-builtin">@if</span>( //<span class="cm-tag-2">article</span> ) {    <span class="cm-comment"># if &lt;article&gt; exists</span>
  <span class="cm-builtin">@append</span>(<span class="cm-tag">&lt;p&gt;</span>): <span class="cm-variable-2">$$</span>    <span class="cm-comment">#   append paragraph into it</span>
}</pre>
                <div><br /></div>

                <blockquote>
                  <p>
                    Check out
                    <a href="#supported-block-functions"
                      >Supported Block Functions</a
                    >
                    to see what else works out of the box.
                  </p>
                </blockquote>
                <h4>
                  <a class="anchor-link" href="#include"
                    ><i class="anchor-icon"></i></a
                  ><a class="anchor" name="include" id="include"></a>Include
                </h4>
                <blockquote>
                  <p>
                    <strong>Note:</strong> This is a service rule, it
                    <strong>will not work</strong> in your templates. It was
                    included in this reference to give you a better
                    understanding of how the system works. You can see an
                    example of this rule at work in the
                    <a href="#processing-pages">Processing Pages</a> section.
                  </p>
                </blockquote>
                <p>
                  Rules of this type begin with the <code>+</code> symbol and
                  use the following format:
                </p>
                <pre
                  class="cm-s-default"
                ><span class="cm-variable-3">+ rules</span></pre>
                <p>
                  This rule inserts a block of rules with the specified name. In
                  most cases, the name corresponds to the domain to which the
                  rules apply.
                </p>
                <p><strong>Examples</strong></p>
                <pre
                  class="cm-s-default"
                ><span class="cm-variable-3">+ core.telegram.org</span> <span class="cm-comment"># inserting the block of rules that is used for core.telegram.org</span>
<span class="cm-def">?not_exists</span>: <span class="cm-variable-2">$body</span>
<span class="cm-variable-3">+ telegram.org</span>      <span class="cm-comment"># inserting the block of rules that is used for telegram.org</span></pre>
                <h4>
                  <a class="anchor-link" href="#special-variables-and"
                    ><i class="anchor-icon"></i></a
                  ><a
                    class="anchor"
                    name="special-variables-and"
                    id="special-variables-and"
                  ></a
                  >Special variables <code>$$</code> and <code>$@</code>
                </h4>
                <p>The special variables work within a group of rules.</p>
                <ul>
                  <li>
                    The <code>$$</code> variable always contains the result of
                    the most recent XPath query.
                  </li>
                  <li>
                    The <code>$@</code> variable holds the return of the most
                    recently run function.
                  </li>
                </ul>
                <p>
                  These variables come in handy when you're creating chains of
                  rules. If a rule is missing xpath_query, the statement is
                  considered to be equal to <code>$$</code>.
                </p>
                <p><strong>Examples</strong></p>
                <pre
                  class="cm-s-default"
                ><span class="cm-comment"># Put a picture into a &lt;figure&gt; tag, then set it as the cover</span>
<span class="cm-builtin">@wrap</span>(<span class="cm-tag">&lt;figure&gt;</span>): //<span class="cm-tag-2">img</span>[<span class="cm-attribute">@id</span>=<span class="cm-string">"cover"</span>]
<span class="cm-variable-2">cover</span>:           <span class="cm-variable-2">$@</span>

<span class="cm-comment"># Insert a divider before each div.divider that's no longer required</span>
<span class="cm-builtin">@before</span>(<span class="cm-tag">&lt;hr&gt;</span>):   //<span class="cm-tag-2">div</span>[<span class="cm-variable">has-class</span>(<span class="cm-string">"divider"</span>)]
<span class="cm-builtin">@remove</span>          <span class="cm-comment"># this is the same as @remove: $$</span></pre>
                <h3>
                  <a class="anchor-link" href="#extended-xpath"
                    ><i class="anchor-icon"></i></a
                  ><a
                    class="anchor"
                    name="extended-xpath"
                    id="extended-xpath"
                  ></a
                  >Extended XPath
                </h3>
                <p>
                  For your convenience, you can use the following constructs in
                  your XPath expressions.
                </p>
                <h4>
                  <a class="anchor-link" href="#context"
                    ><i class="anchor-icon"></i></a
                  ><a class="anchor" name="context" id="context"></a>Context
                </h4>
                <p>
                  Regular XPath queries search for nodes in the context of the
                  entire document. To specify the context for a particular
                  expression, you can use variables in the format
                  <code>$context</code>. If a matching variable exists, the
                  query will be made relative to each variable node. If it
                  doesn't and a matching property exists, the query will be made
                  relative to the property node. If no matching variables or
                  properties exist, the query return an empty list.
                </p>
                <p><strong>Examples</strong></p>
                <pre
                  class="cm-s-default"
                ><span class="cm-variable-2">$headers</span>:      //<span class="cm-tag-2">h1</span>              <span class="cm-comment"># all &lt;h1&gt; tags on the page</span>
<span class="cm-variable-2">article</span>:       //<span class="cm-tag-2">article</span>         <span class="cm-comment"># the first &lt;article&gt; tag on the page</span>
<span class="cm-variable-2">$art_headers</span>:  <span class="cm-variable-2">$article</span>//<span class="cm-tag-2">h1</span>      <span class="cm-comment"># all &lt;h1&gt; tags inside article</span>
<span class="cm-variable-2">$header_links</span>: <span class="cm-variable-2">$art_headers</span>//<span class="cm-tag-2">a</span>   <span class="cm-comment"># all &lt;a&gt; tags inside each $art_headers node</span></pre>
                <h4>
                  <a class="anchor-link" href="#zeroing-in-on-nodes"
                    ><i class="anchor-icon"></i></a
                  ><a
                    class="anchor"
                    name="zeroing-in-on-nodes"
                    id="zeroing-in-on-nodes"
                  ></a
                  >Zeroing in on nodes
                </h4>
                <p>
                  The result of an XPath query is always a list of matching
                  nodes. If you'd like to narrow the list down to a single node,
                  you can use the following syntax:
                  <code>(xpath_query)[n]</code>, where <code>n</code> is the
                  number of the desired node. Numbering starts at 1, you can get
                  the last node by using the <code>last()</code> function. This
                  syntax can only be applied to the entire expression.
                </p>
                <p><strong>Examples</strong></p>
                <pre
                  class="cm-s-default"
                ><span class="cm-variable-2">$headers</span>:    //<span class="cm-tag-2">h1</span>                    <span class="cm-comment"># all &lt;h1&gt; tags on the page</span>
<span class="cm-variable-2">$header2</span>:    (//<span class="cm-tag-2">h1</span>)[<span class="cm-number">2</span>]               <span class="cm-comment"># the second &lt;h1&gt; tag on the page</span>
<span class="cm-variable-2">$header2</span>:    (<span class="cm-variable-2">$headers</span>)[<span class="cm-number">2</span>]           <span class="cm-comment"># same</span>
<span class="cm-variable-2">$last_link</span>:  (<span class="cm-variable-2">$header2</span>//<span class="cm-tag-2">a</span>)[<span class="cm-number">last()</span>]   <span class="cm-comment"># the last link inside $header2</span></pre>
                <h4>
                  <a class="anchor-link" href="#has-class"
                    ><i class="anchor-icon"></i></a
                  ><a class="anchor" name="has-class" id="has-class"></a
                  >has-class
                </h4>
                <p>
                  You will often need to locate nodes that have a certain class.
                  To do this, you can use the
                  <code>has-class("class")</code> function that serves as an
                  alias for the expression
                  <code
                    >contains(concat(" ", normalize-space(@class), " "), " class
                    ")</code
                  >.
                </p>
                <p><strong>Examples</strong></p>
                <pre
                  class="cm-s-default"
                ><span class="cm-comment"># Transform all div.header elements into h1</span>
<span class="cm-tag">&lt;h1&gt;</span>: //<span class="cm-tag-2">div</span>[<span class="cm-variable">contains</span>(<span class="cm-variable">concat</span>(<span class="cm-string">" "</span>, <span class="cm-variable">normalize-space</span>(<span class="cm-attribute">@class</span>), <span class="cm-string">" "</span>), <span class="cm-string">" header "</span>)]
<span class="cm-comment"># same idea, but much shorter</span>
<span class="cm-tag">&lt;h1&gt;</span>: //<span class="cm-tag-2">div</span>[<span class="cm-variable">has-class</span>(<span class="cm-string">"header"</span>)]</pre>
                <h4>
                  <a class="anchor-link" href="#ends-with"
                    ><i class="anchor-icon"></i></a
                  ><a class="anchor" name="ends-with" id="ends-with"></a
                  >ends-with
                </h4>
                <p>
                  XPath has a <code>starts-with</code> function that checks
                  whether the first string starts with the second string but
                  does not have <code>ends-with</code>. In IV you can use the
                  <code>ends-with("haystack","needle")</code> function that
                  serves as an alias for the expression
                  <code
                    >(substring("haystack", string-length("haystack") -
                    string-length("needle") + 1) = "needle")</code
                  >.
                </p>
                <p><strong>Examples</strong></p>
                <pre
                  class="cm-s-default"
                ><span class="cm-comment"># Select all JPG images</span>
<span class="cm-builtin">@debug</span>: //<span class="cm-tag-2">img</span>[(<span class="cm-variable">substring</span>(<span class="cm-attribute">@src</span>, <span class="cm-variable">string-length</span>(<span class="cm-attribute">@src</span>) - <span class="cm-variable">string-length</span>(<span class="cm-string">".jpg"</span>) + <span class="cm-number">1</span>) = <span class="cm-string">".jpg"</span>)]
<span class="cm-comment"># the same, but much shorter</span>
<span class="cm-builtin">@debug</span>: //<span class="cm-tag-2">img</span>[<span class="cm-variable">ends-with</span>(<span class="cm-attribute">@src</span>, <span class="cm-string">".jpg"</span>)]</pre>
                <h4>
                  <a class="anchor-link" href="#prev-sibling"
                    ><i class="anchor-icon"></i></a
                  ><a class="anchor" name="prev-sibling" id="prev-sibling"></a
                  >prev-sibling
                </h4>
                <p>
                  An axis that selects the previous sibling of the current node.
                  Serves as an alias for the expression
                  <code>preceding-sibling::*[1]/self</code>.
                </p>
                <p><strong>Examples</strong></p>
                <pre
                  class="cm-s-default"
                ><span class="cm-comment"># Transform all div nodes, that immediately follow img nodes into figcaption</span>
<span class="cm-tag">&lt;figcaption&gt;</span>: //<span class="cm-tag-2">div</span>[./preceding-sibling::<span class="cm-tag-2">*</span>[<span class="cm-number">1</span>]/self::<span class="cm-tag-2">img</span>]
<span class="cm-comment"># the same</span>
<span class="cm-tag">&lt;figcaption&gt;</span>: //<span class="cm-tag-2">div</span>[./prev-sibling::<span class="cm-tag-2">img</span>]</pre>
                <h4>
                  <a class="anchor-link" href="#next-sibling"
                    ><i class="anchor-icon"></i></a
                  ><a class="anchor" name="next-sibling" id="next-sibling"></a
                  >next-sibling
                </h4>
                <p>
                  An axis that selects the next sibling of the current node.
                  Serves as an alias for the expression
                  <code>following-sibling::*[1]/self</code>
                </p>
                <p><strong>Examples</strong></p>
                <pre
                  class="cm-s-default"
                ><span class="cm-comment"># Join paragraphs following each other into one, separating them with a line break</span>
<span class="cm-builtin">@combine</span>(<span class="cm-tag">&lt;br&gt;</span>): //<span class="cm-tag-2">p</span>/following-sibling::<span class="cm-tag-2">*</span>[<span class="cm-number">1</span>]/self::<span class="cm-tag-2">p</span>
<span class="cm-comment"># the same, but shorter</span>
<span class="cm-builtin">@combine</span>(<span class="cm-tag">&lt;br&gt;</span>): //<span class="cm-tag-2">p</span>/next-sibling::<span class="cm-tag-2">p</span></pre>
                <h3>
                  <a class="anchor-link" href="#supported-conditions"
                    ><i class="anchor-icon"></i></a
                  ><a
                    class="anchor"
                    name="supported-conditions"
                    id="supported-conditions"
                  ></a
                  >Supported conditions
                </h3>
                <p>Below are conditions supported in Instant View rules.</p>
                <h4>
                  <a class="anchor-link" href="#domain"
                    ><i class="anchor-icon"></i></a
                  ><a class="anchor" name="domain" id="domain"></a>domain
                </h4>
                <pre
                  class="cm-s-default"
                ><span class="cm-variable-2">domain</span>: <span class="cm-variable">regexp</span></pre>
                <p>
                  Checks whether the domain of the current page matches a
                  regular expression. The check is case-insensitive, so the
                  actual expression used will look like this:
                  <code>/^regexp$/i</code>.
                </p>
                <p><strong>Examples</strong></p>
                <pre
                  class="cm-s-default"
                ><span class="cm-comment"># Rule for *.subdomain.example.com URLs</span>
<span class="cm-def">?domain</span>: .+\.subdomain\.example\.com</pre>
                <h4>
                  <a class="anchor-link" href="#domain-not"
                    ><i class="anchor-icon"></i></a
                  ><a class="anchor" name="domain-not" id="domain-not"></a
                  >domain_not
                </h4>
                <pre
                  class="cm-s-default"
                ><span class="cm-variable-2">domain_not</span>: <span class="cm-variable">regexp</span></pre>
                <p>
                  Checks whether the domain of the current page does not match a
                  regular expression. The check is case-insensitive, so the
                  actual expression used will look like this:
                  <code>/^regexp$/i</code>.
                </p>
                <p><strong>Examples</strong></p>
                <pre
                  class="cm-s-default"
                ><span class="cm-comment"># Rule for *.subdomain.example.com URLs with an exception for dev.subdomain.example.com</span>
<span class="cm-def">?domain</span>:     .+\.subdomain\.example\.com
<span class="cm-def">!domain_not</span>: dev\.subdomain\.example\.com</pre>
                <h4>
                  <a class="anchor-link" href="#path"
                    ><i class="anchor-icon"></i></a
                  ><a class="anchor" name="path" id="path"></a>path
                </h4>
                <pre
                  class="cm-s-default"
                ><span class="cm-variable-2">path</span>: <span class="cm-variable">regexp</span></pre>
                <p>
                  Checks whether the path to the current page matches a regular
                  expression. The check is case-insensitive, so the actual
                  expression used will look like this: <code>/^regexp$/i</code>.
                </p>
                <p><strong>Examples</strong></p>
                <pre
                  class="cm-s-default"
                ><span class="cm-comment"># Rule for example.com/news/* links</span>
<span class="cm-def">?path</span>: /news/.+   <span class="cm-comment"># no need to escape the slash</span></pre>
                <h4>
                  <a class="anchor-link" href="#path-not"
                    ><i class="anchor-icon"></i></a
                  ><a class="anchor" name="path-not" id="path-not"></a>path_not
                </h4>
                <pre
                  class="cm-s-default"
                ><span class="cm-variable-2">path_not</span>: <span class="cm-variable">regexp</span></pre>
                <p>
                  Checks whether the path to the current page does not match a
                  regular expression. The check is case-insensitive, so the
                  actual expression used will look like this:
                  <code>/^regexp$/i</code>.
                </p>
                <p><strong>Examples</strong></p>
                <pre
                  class="cm-s-default"
                ><span class="cm-comment"># Rule for example.com/news/* links with an exception for example.com/news/recent</span>
<span class="cm-def">?path</span>:     /news/.+
<span class="cm-def">!path_not</span>: /news/recent</pre>
                <h4>
                  <a class="anchor-link" href="#exists"
                    ><i class="anchor-icon"></i></a
                  ><a class="anchor" name="exists" id="exists"></a>exists
                </h4>
                <pre
                  class="cm-s-default"
                ><span class="cm-variable-2">exists</span>: <span class="cm-variable">xpath_query</span></pre>
                <p>Checks whether target nodes exist on the current page.</p>
                <p><strong>Examples</strong></p>
                <pre
                  class="cm-s-default"
                ><span class="cm-comment"># Apply rule only to pages with an &lt;article&gt; tag</span>
<span class="cm-def">?exists</span>: //<span class="cm-tag-2">article</span></pre>
                <h4>
                  <a class="anchor-link" href="#not-exists"
                    ><i class="anchor-icon"></i></a
                  ><a class="anchor" name="not-exists" id="not-exists"></a
                  >not_exists
                </h4>
                <pre
                  class="cm-s-default"
                ><span class="cm-variable-2">not_exists</span>: <span class="cm-variable">xpath_query</span></pre>
                <p>
                  Checks whether target nodes do not exist on the current page.
                </p>
                <p><strong>Examples</strong></p>
                <pre
                  class="cm-s-default"
                ><span class="cm-comment"># Apply rule only to pages with an &lt;article&gt; tag, that do not include any quotes.</span>
<span class="cm-def">?exists</span>:     //<span class="cm-tag-2">article</span>
<span class="cm-def">!not_exists</span>: //<span class="cm-tag-2">article</span>//<span class="cm-tag-2">blockquote</span></pre>
                <h4>
                  <a class="anchor-link" href="#true"
                    ><i class="anchor-icon"></i></a
                  ><a class="anchor" name="true" id="true"></a>true
                </h4>
                <pre
                  class="cm-s-default"
                ><span class="cm-variable-2">true</span></pre>
                <p>A condition that is always true.</p>
                <p><strong>Examples</strong></p>
                <pre
                  class="cm-s-default"
                ><span class="cm-def">?path</span>:    /blog/.+
<span class="cm-comment"># Rules for the blog section go here</span>
<span class="cm-def">?true</span>
<span class="cm-comment"># Rules that go here will be applied to all pages</span></pre>
                <h4>
                  <a class="anchor-link" href="#false"
                    ><i class="anchor-icon"></i></a
                  ><a class="anchor" name="false" id="false"></a>false
                </h4>
                <pre
                  class="cm-s-default"
                ><span class="cm-variable-2">false</span></pre>
                <p>A condition that is always false.</p>
                <p><strong>Examples</strong></p>
                <pre
                  class="cm-s-default"
                ><span class="cm-def">?path</span>:    /news/.+
<span class="cm-comment"># Rules for the news section go here</span>
<span class="cm-def">?false</span>
<span class="cm-comment"># Rules that go here will never be applied</span></pre>
                <h3>
                  <a class="anchor-link" href="#supported-options"
                    ><i class="anchor-icon"></i></a
                  ><a
                    class="anchor"
                    name="supported-options"
                    id="supported-options"
                  ></a
                  >Supported options
                </h3>
                <p>Below are options supported in Instant View rules.</p>
                <h4>
                  <a class="anchor-link" href="#version"
                    ><i class="anchor-icon"></i></a
                  ><a class="anchor" name="version" id="version"></a>version
                </h4>
                <pre
                  class="cm-s-default"
                ><span class="cm-keyword">~version</span>: <span class="cm-string">"2.1"</span></pre>
                <p>
                  Sets the version of IV used in the template. The behavior of
                  some IV functions may change according to the version provided
                  (see the manual of corresponding function).<br />The value
                  must be one of <code>"1.0"</code>, <code>"2.0"</code> or
                  <code>"2.1"</code>. We recommend using the latest version,
                  <strong>2.1</strong>.
                </p>
                <p><strong>Examples</strong></p>
                <pre
                  class="cm-s-default"
                ><span class="cm-keyword">~version</span>: <span class="cm-string">"2.1"</span>
<span class="cm-comment"># Now you can use new features from IV 2.1</span></pre>
                <blockquote>
                  <p>
                    Please note that <code>version</code> should be set at the
                    beginning of the template before any other rules.
                  </p>
                </blockquote>
                <h4>
                  <a class="anchor-link" href="#allowed-origin-new"
                    ><i class="anchor-icon"></i></a
                  ><a
                    class="anchor"
                    name="allowed-origin-new"
                    id="allowed-origin-new"
                  ></a
                  >allowed_origin
                  <sup
                    ><mark><strong>NEW</strong></mark></sup
                  >
                </h4>
                <pre
                  class="cm-s-default"
                ><span class="cm-keyword">~allowed_origin</span>: <span class="cm-string">"https://example.com"</span>
<span class="cm-keyword">~allowed_origin</span>: [<span class="cm-string">"https://example.com"</span>, <span class="cm-string">"https://subdomain.example.com"</span>]</pre>
                <p>
                  Sets the origin (or the list of origins) from which content
                  can be loaded using the <a href="#load-new">@load</a> and
                  <a href="#inline">@inline</a> functions.<br />The value should
                  be <em>String</em> or <em>Array of String</em>.
                </p>
                <p><strong>Examples</strong></p>
                <pre
                  class="cm-s-default"
                ><span class="cm-keyword">~allowed_origin</span>: <span class="cm-string">"https://api.example.com"</span>
<span class="cm-comment"># Now you can load content from https://api.example.com regardless of the origin of current page</span>
<span class="cm-builtin">@load</span>: <span class="cm-string">"https://api.example.com/get/article"</span></pre>
                <h3>
                  <a class="anchor-link" href="#supported-functions"
                    ><i class="anchor-icon"></i></a
                  ><a
                    class="anchor"
                    name="supported-functions"
                    id="supported-functions"
                  ></a
                  >Supported functions
                </h3>
                <p>The general format for a function is the following:</p>
                <pre
                  class="cm-s-default"
                ><span class="cm-builtin">@function</span>: <span class="cm-variable">xpath_query</span></pre>
                <p>
                  Each function accepts the list of nodes returned by the XPath
                  statement as the main parameter. You may omit
                  <code>xpath_query</code>, in which case <code>$$</code>, the
                  result of the previous XPath query, will be passed into the
                  function. The function then processes each element in the list
                  and returns a list of transformed nodes which are stored in
                  the <code>$@</code> variable.
                </p>
                <p>
                  Below is a list of functions that are supported in Instant
                  View rules.
                </p>
                <h4>
                  <a class="anchor-link" href="#debug"
                    ><i class="anchor-icon"></i></a
                  ><a class="anchor" name="debug" id="debug"></a>debug
                </h4>
                <pre
                  class="cm-s-default"
                ><span class="cm-builtin">@debug</span>: <span class="cm-variable">xpath_query</span></pre>
                <p>
                  Logs the elements passed into the function, these elements
                  will be displayed in the status line at the bottom of the
                  screen in the
                  <a
                    href="https://instantview.telegram.org/#instant-view-editor"
                    >Instant View Editor</a
                  >. Returns the elements passed. Consider combining with
                  <a href="#special-variables-and"
                    ><code>$$</code> and <code>$@</code></a
                  >.
                </p>
                <p><strong>Example</strong></p>
                <pre
                  class="cm-s-default"
                ><span class="cm-builtin">@debug</span>: //<span class="cm-tag-2">article</span>//<span class="cm-tag-2">a</span>     <span class="cm-comment"># displays all links from the page in the log</span>
<span class="cm-builtin">@debug</span>                   <span class="cm-comment"># displays all links again</span></pre>
                <div><br /></div>

                <p>Look for debug output at the bottom of your Editor:</p>
                <div>
                  <a
                    href="/file/811140378/19ec/lgDhyQ_HKcc.120673/c7602c526f316dc5a4"
                    target="_blank"
                    ><img
                      src="/file/811140378/19ec/lgDhyQ_HKcc.120673/c7602c526f316dc5a4"
                      title="Debug console at the bottom of the screen"
                      class="dev_page_image"
                      style="max-width: 600px"
                  /></a>
                </div>

                <h4>
                  <a class="anchor-link" href="#remove"
                    ><i class="anchor-icon"></i></a
                  ><a class="anchor" name="remove" id="remove"></a>remove
                </h4>
                <pre
                  class="cm-s-default"
                ><span class="cm-builtin">@remove</span>: <span class="cm-variable">xpath_query</span></pre>
                <p>
                  Removes target nodes from the page, returns an empty list.
                </p>
                <p><strong>Examples</strong></p>
                <pre
                  class="cm-s-default"
                ><span class="cm-builtin">@remove</span>: //<span class="cm-tag-2">div</span>[<span class="cm-variable">has-class</span>(<span class="cm-string">"related"</span>)] <span class="cm-comment"># remove article div.related</span>
<span class="cm-builtin">@debug</span>                               <span class="cm-comment"># empty list</span></pre>
                <h4>
                  <a class="anchor-link" href="#append"
                    ><i class="anchor-icon"></i></a
                  ><a class="anchor" name="append" id="append"></a>append
                </h4>
                <pre
                  class="cm-s-default"
                ><span class="cm-builtin">@append</span>(<span class="cm-string">"Some text"</span>): <span class="cm-variable">xpath_query</span>
<span class="cm-builtin">@append</span>(<span class="cm-attribute">@attr</span>):       <span class="cm-variable">xpath_query</span>
<span class="cm-builtin">@append</span>(<span class="cm-tag">&lt;tag&gt;</span>):       <span class="cm-variable">xpath_query</span>
<span class="cm-builtin">@append</span>(<span class="cm-tag">&lt;tag&gt;</span>, <span class="cm-variable">attr</span>, <span class="cm-variable">value</span>[, <span class="cm-variable">attr</span>, <span class="cm-variable">value</span>[, ...]]): <span class="cm-variable">xpath_query</span></pre>
                <p>
                  Inserts content, specified by the parameter, to the end of
                  each target node.
                </p>
                <ul>
                  <li>
                    If the first parameter is in angle brackets, a new
                    <code>&lt;tag&gt;</code> node will be created. The following
                    two parameters then specify the name and value of an
                    attribute for that node. If <code>value</code> has the
                    format <code>@attr</code>, the value of the attribute
                    <code>attr</code> in the target node will be used as the
                    value. <code>value</code> can be an XPath expression that
                    begins with <code>.</code>, in this case the query will be
                    executed relative to the relevant node, and the text value
                    of the returned elements will be used as the attribute's
                    value. Otherwise, <code>value</code> will be used as the
                    attribute's value.
                  </li>
                  <li>
                    If the first parameter has the format <code>@attr</code>, a
                    new text element with value of the attribute
                    <code>attr</code> of the targeted node will be created.
                  </li>
                  <li>
                    Otherwise, a text element with the text specified in the
                    first parameter will be created.
                  </li>
                </ul>
                <p>Returns a list of the newly created nodes.</p>
                <p><strong>Examples</strong></p>
                <pre
                  class="cm-s-default"
                ><span class="cm-comment"># &lt;div class="a"&gt;&lt;em&gt;1&lt;/em&gt;&lt;/div&gt;</span>
<span class="cm-builtin">@append</span>(<span class="cm-tag">&lt;p&gt;</span>): //<span class="cm-tag-2">div</span>
<span class="cm-comment"># &lt;div class="a"&gt;&lt;em&gt;1&lt;/em&gt;&lt;p&gt;&lt;/p&gt;&lt;/div&gt;</span></pre>
                <h4>
                  <a class="anchor-link" href="#prepend"
                    ><i class="anchor-icon"></i></a
                  ><a class="anchor" name="prepend" id="prepend"></a>prepend
                </h4>
                <pre
                  class="cm-s-default"
                ><span class="cm-builtin">@prepend</span>(<span class="cm-string">"Some text"</span>): <span class="cm-variable">xpath_query</span>
<span class="cm-builtin">@prepend</span>(<span class="cm-attribute">@attr</span>):       <span class="cm-variable">xpath_query</span>
<span class="cm-builtin">@prepend</span>(<span class="cm-tag">&lt;tag&gt;</span>):       <span class="cm-variable">xpath_query</span>
<span class="cm-builtin">@prepend</span>(<span class="cm-tag">&lt;tag&gt;</span>, <span class="cm-variable">attr</span>, <span class="cm-variable">value</span>[, <span class="cm-variable">attr</span>, <span class="cm-variable">value</span>[, ...]]): <span class="cm-variable">xpath_query</span></pre>
                <p>
                  Inserts content, specified by the parameter, to the beginning
                  of each target node.
                </p>
                <ul>
                  <li>
                    If the first parameter is in angle brackets, a new
                    <code>&lt;tag&gt;</code> node will be created. The following
                    two parameters then specify the name and value of an
                    attribute for that node. If <code>value</code> has the
                    format <code>@attr</code>, the value of the attribute
                    <code>attr</code> in the target node will be used as the
                    value. <code>value</code> can be an XPath expression that
                    begins with <code>.</code>, in this case the query will be
                    executed relative to the relevant node, and the text value
                    of the returned elements will be used as the attribute's
                    value. Otherwise, <code>value</code> will be used as the
                    attribute's value.
                  </li>
                  <li>
                    If the first parameter has the format <code>@attr</code>, a
                    new text element with value of the attribute
                    <code>attr</code> of the targeted node will be created.
                  </li>
                  <li>
                    Otherwise, a text element with the text specified in the
                    first parameter will be created.
                  </li>
                </ul>
                <p>Returns a list of the newly created nodes.</p>
                <p><strong>Examples</strong></p>
                <pre
                  class="cm-s-default"
                ><span class="cm-comment"># &lt;div class="a"&gt;&lt;em&gt;1&lt;/em&gt;&lt;/div&gt;</span>
<span class="cm-builtin">@prepend</span>(<span class="cm-tag">&lt;p&gt;</span>, <span class="cm-variable">data-class</span>, <span class="cm-attribute">@class</span>): //<span class="cm-tag-2">div</span>
<span class="cm-comment"># &lt;div class="a"&gt;&lt;p data-class="a"&gt;&lt;/p&gt;&lt;em&gt;1&lt;/em&gt;&lt;/div&gt;</span></pre>
                <h4>
                  <a class="anchor-link" href="#after"
                    ><i class="anchor-icon"></i></a
                  ><a class="anchor" name="after" id="after"></a>after
                </h4>
                <pre
                  class="cm-s-default"
                ><span class="cm-builtin">@after</span>(<span class="cm-string">"Some text"</span>): <span class="cm-variable">xpath_query</span>
<span class="cm-builtin">@after</span>(<span class="cm-attribute">@attr</span>):       <span class="cm-variable">xpath_query</span>
<span class="cm-builtin">@after</span>(<span class="cm-tag">&lt;tag&gt;</span>):       <span class="cm-variable">xpath_query</span>
<span class="cm-builtin">@after</span>(<span class="cm-tag">&lt;tag&gt;</span>, <span class="cm-variable">attr</span>, <span class="cm-variable">value</span>[, <span class="cm-variable">attr</span>, <span class="cm-variable">value</span>[, ...]]): <span class="cm-variable">xpath_query</span></pre>
                <p>
                  Inserts content, specified by the parameter, after each target
                  node.
                </p>
                <ul>
                  <li>
                    If the first parameter is in angle brackets, a new
                    <code>&lt;tag&gt;</code> node will be created. The following
                    two parameters then specify the name and value of an
                    attribute for that node. If <code>value</code> has the
                    format <code>@attr</code>, the value of the attribute
                    <code>attr</code> in the target node will be used as the
                    value. <code>value</code> can be an XPath expression that
                    begins with <code>.</code>, in this case the query will be
                    executed relative to the relevant node, and the text value
                    of the returned elements will be used as the attribute's
                    value. Otherwise, <code>value</code> will be used as the
                    attribute's value.
                  </li>
                  <li>
                    If the first parameter has the format <code>@attr</code>, a
                    new text element with value of the attribute
                    <code>attr</code> of the targeted node will be created.
                  </li>
                  <li>
                    Otherwise, a text element with the text specified in the
                    first parameter will be created.
                  </li>
                </ul>
                <p>Returns a list of the newly created nodes.</p>
                <p><strong>Examples</strong></p>
                <pre
                  class="cm-s-default"
                ><span class="cm-comment"># &lt;div class="a"&gt;&lt;em&gt;1&lt;/em&gt;&lt;em&gt;2&lt;/em&gt;&lt;/div&gt;</span>
<span class="cm-builtin">@after</span>(<span class="cm-string">"!"</span>): //<span class="cm-tag-2">div</span>/<span class="cm-tag-2">em</span>
<span class="cm-comment"># &lt;div class="a"&gt;&lt;em&gt;1&lt;/em&gt;!&lt;em&gt;2&lt;/em&gt;!&lt;/div&gt;</span></pre>
                <h4>
                  <a class="anchor-link" href="#before"
                    ><i class="anchor-icon"></i></a
                  ><a class="anchor" name="before" id="before"></a>before
                </h4>
                <pre
                  class="cm-s-default"
                ><span class="cm-builtin">@before</span>(<span class="cm-string">"Some text"</span>): <span class="cm-variable">xpath_query</span>
<span class="cm-builtin">@before</span>(<span class="cm-attribute">@attr</span>):       <span class="cm-variable">xpath_query</span>
<span class="cm-builtin">@before</span>(<span class="cm-tag">&lt;tag&gt;</span>):       <span class="cm-variable">xpath_query</span>
<span class="cm-builtin">@before</span>(<span class="cm-tag">&lt;tag&gt;</span>, <span class="cm-variable">attr</span>, <span class="cm-variable">value</span>[, <span class="cm-variable">attr</span>, <span class="cm-variable">value</span>[, ...]]): <span class="cm-variable">xpath_query</span></pre>
                <p>
                  Inserts content, specified by the parameter, before each
                  target node.
                </p>
                <ul>
                  <li>
                    If the first parameter is in angle brackets, a new
                    <code>&lt;tag&gt;</code> node will be created. The following
                    two parameters then specify the name and value of an
                    attribute for that node. If <code>value</code> has the
                    format <code>@attr</code>, the value of the attribute
                    <code>attr</code> in the target node will be used as the
                    value. <code>value</code> can be an XPath expression that
                    begins with <code>.</code>, in this case the query will be
                    executed relative to the relevant node, and the text value
                    of the returned elements will be used as the attribute's
                    value. Otherwise, <code>value</code> will be used as the
                    attribute's value.
                  </li>
                  <li>
                    If the first parameter has the format <code>@attr</code>, a
                    new text element with value of the attribute
                    <code>attr</code> of the targeted node will be created.
                  </li>
                  <li>
                    Otherwise, a text element with the text specified in the
                    first parameter will be created.
                  </li>
                </ul>
                <p>Returns a list of the newly created nodes.</p>
                <p><strong>Examples</strong></p>
                <pre
                  class="cm-s-default"
                ><span class="cm-comment"># &lt;div class="a"&gt;&lt;em&gt;1&lt;/em&gt;&lt;/div&gt;</span>
<span class="cm-builtin">@before</span>(<span class="cm-string">"@"</span>): //<span class="cm-tag-2">div</span>/<span class="cm-tag-2">em</span>
<span class="cm-comment"># &lt;div class="a"&gt;@&lt;em&gt;1&lt;/em&gt;&lt;/div&gt;</span></pre>
                <h4>
                  <a class="anchor-link" href="#append-to"
                    ><i class="anchor-icon"></i></a
                  ><a class="anchor" name="append-to" id="append-to"></a
                  >append_to
                </h4>
                <pre
                  class="cm-s-default"
                ><span class="cm-builtin">@append_to</span>(<span class="cm-variable">xpath_query</span>): <span class="cm-variable">xpath_query</span>
<span class="cm-builtin">@append_to</span>(<span class="cm-variable-2">$var</span>):        <span class="cm-variable">xpath_query</span></pre>
                <p>Inserts each target node to the end of the base node.</p>
                <p>
                  The first parameter specifies the base node. You can pass an
                  XPath expression that begins with <code>.</code>, in this case
                  the query will be executed relative to the relevant node. The
                  <em>first relevant node</em> will be used as the base node.
                  You can also pass a variable name. If such a variable exists,
                  the <em>first relevant node</em> will be used as the base
                  node. If the variable doesn't exist or is empty, the property
                  with a matching name will be used as the base node.
                </p>
                <p>Returns a list of target nodes.</p>
                <p><strong>Examples</strong></p>
                <pre
                  class="cm-s-default"
                ><span class="cm-variable-2">$div</span>:             //<span class="cm-tag-2">div</span>
<span class="cm-comment"># &lt;div class="a"&gt;&lt;em&gt;&lt;/em&gt;&lt;/div&gt;&lt;p&gt;Text&lt;/p&gt;</span>
<span class="cm-builtin">@append_to</span>(<span class="cm-variable-2">$div</span>): //<span class="cm-tag-2">p</span>
<span class="cm-comment"># &lt;div class="a"&gt;&lt;em&gt;&lt;/em&gt;&lt;p&gt;Text&lt;/p&gt;&lt;/div&gt;</span></pre>
                <h4>
                  <a class="anchor-link" href="#prepend-to"
                    ><i class="anchor-icon"></i></a
                  ><a class="anchor" name="prepend-to" id="prepend-to"></a
                  >prepend_to
                </h4>
                <pre
                  class="cm-s-default"
                ><span class="cm-builtin">@prepend_to</span>(<span class="cm-variable">xpath_query</span>): <span class="cm-variable">xpath_query</span>
<span class="cm-builtin">@prepend_to</span>(<span class="cm-variable-2">$var</span>):        <span class="cm-variable">xpath_query</span></pre>
                <p>
                  Inserts each target node to the beginning of the base node.
                </p>
                <p>
                  The first parameter specifies the base node. You can pass an
                  XPath expression that begins with <code>.</code>, in this case
                  the query will be executed relative to the relevant node. The
                  <em>first relevant node</em> will be used as the base node.
                  You can also pass a variable name. If such a variable exists,
                  the <em>first relevant node</em> will be used as the base
                  node. If the variable doesn't exist or is empty, the property
                  with a matching name will be used as the base node.
                </p>
                <p>Returns a list of target nodes.</p>
                <p><strong>Examples</strong></p>
                <pre
                  class="cm-s-default"
                ><span class="cm-variable-2">$div</span>:              //<span class="cm-tag-2">div</span>
<span class="cm-comment"># &lt;div class="a"&gt;&lt;em&gt;&lt;/em&gt;&lt;/div&gt;&lt;p&gt;Text&lt;/p&gt;</span>
<span class="cm-builtin">@prepend_to</span>(<span class="cm-variable-2">$div</span>): //<span class="cm-tag-2">p</span>
<span class="cm-comment"># &lt;div class="a"&gt;&lt;p&gt;Text&lt;/p&gt;&lt;em&gt;&lt;/em&gt;&lt;/div&gt;</span></pre>
                <h4>
                  <a class="anchor-link" href="#after-el"
                    ><i class="anchor-icon"></i></a
                  ><a class="anchor" name="after-el" id="after-el"></a>after_el
                </h4>
                <pre
                  class="cm-s-default"
                ><span class="cm-builtin">@after_el</span>(<span class="cm-variable">xpath_query</span>): <span class="cm-variable">xpath_query</span>
<span class="cm-builtin">@after_el</span>(<span class="cm-variable-2">$var</span>):        <span class="cm-variable">xpath_query</span></pre>
                <p>Inserts each target node after the base node.</p>
                <p>
                  The first parameter specifies the base node. You can pass an
                  XPath expression that begins with <code>.</code>, in this case
                  the query will be executed relative to the relevant node. The
                  <em>first relevant node</em> will be used as the base node.
                  You can also pass a variable name. If such a variable exists,
                  the <em>first relevant node</em> will be used as the base
                  node. If the variable doesn't exist or is empty, the property
                  with a matching name will be used as the base node.
                </p>
                <p>Returns a list of target nodes.</p>
                <p><strong>Examples</strong></p>
                <pre
                  class="cm-s-default"
                ><span class="cm-variable-2">$div</span>:                        //<span class="cm-tag-2">div</span>
<span class="cm-comment"># &lt;div class="a"&gt;&lt;p&gt;Text&lt;/p&gt;&lt;em&gt;&lt;/em&gt;&lt;/div&gt;</span>
<span class="cm-builtin">@after_el</span>(<span class="cm-string">"./../self::div"</span>): //<span class="cm-tag-2">p</span>
<span class="cm-comment"># &lt;div class="a"&gt;&lt;em&gt;&lt;/em&gt;&lt;/div&gt;&lt;p&gt;Text&lt;/p&gt;</span></pre>
                <h4>
                  <a class="anchor-link" href="#before-el"
                    ><i class="anchor-icon"></i></a
                  ><a class="anchor" name="before-el" id="before-el"></a
                  >before_el
                </h4>
                <pre
                  class="cm-s-default"
                ><span class="cm-builtin">@before_el</span>(<span class="cm-variable">xpath_query</span>): <span class="cm-variable">xpath_query</span>
<span class="cm-builtin">@before_el</span>(<span class="cm-variable-2">$var</span>):        <span class="cm-variable">xpath_query</span></pre>
                <p>Inserts each target node before the base node.</p>
                <p>
                  The first parameter specifies the base node. You can pass an
                  XPath expression that begins with <code>.</code>, in this case
                  the query will be executed relative to the relevant node. The
                  <em>first relevant node</em> will be used as the base node.
                  You can also pass a variable name. If such a variable exists,
                  the <em>first relevant node</em> will be used as the base
                  node. If the variable doesn't exist or is empty, the property
                  with a matching name will be used as the base node.
                </p>
                <p>Returns a list of target nodes.</p>
                <p><strong>Examples</strong></p>
                <pre
                  class="cm-s-default"
                ><span class="cm-variable-2">$div</span>:                        //<span class="cm-tag-2">div</span>
<span class="cm-comment"># &lt;div class="a"&gt;&lt;p&gt;Text&lt;/p&gt;&lt;em&gt;&lt;/em&gt;&lt;/div&gt;</span>
<span class="cm-builtin">@before_el</span>(<span class="cm-string">"./../self::div"</span>): //<span class="cm-tag-2">p</span>
<span class="cm-comment"># &lt;p&gt;Text&lt;/p&gt;&lt;div class="a"&gt;&lt;em&gt;&lt;/em&gt;&lt;/div&gt;</span></pre>
                <h4>
                  <a class="anchor-link" href="#replace-tag"
                    ><i class="anchor-icon"></i></a
                  ><a class="anchor" name="replace-tag" id="replace-tag"></a
                  >replace_tag
                </h4>
                <pre
                  class="cm-s-default"
                ><span class="cm-builtin">@replace_tag</span>(<span class="cm-tag">&lt;tag&gt;</span>):     <span class="cm-variable">xpath_query</span>
<span class="cm-tag">&lt;tag&gt;</span>:                   <span class="cm-variable">xpath_query</span></pre>
                <p>
                  Changes the name of the tag. The new name for the tag should
                  be passed as the first parameter. Returns target nodes.
                </p>
                <p><strong>Examples</strong></p>
                <pre
                  class="cm-s-default"
                ><span class="cm-comment"># &lt;div class="list unordered"&gt;&lt;div class="item"&gt;&lt;/div&gt;&lt;div class="item"&gt;&lt;/div&gt;&lt;/div&gt;</span>
<span class="cm-builtin">@replace_tag</span>(<span class="cm-tag">&lt;li&gt;</span>): //<span class="cm-tag-2">div</span>[<span class="cm-variable">has-class</span>(<span class="cm-string">"item"</span>)]
<span class="cm-tag">&lt;ul&gt;</span>:               //<span class="cm-tag-2">div</span>[<span class="cm-variable">has-class</span>(<span class="cm-string">"list"</span>)]
<span class="cm-comment"># &lt;ul class="list unordered"&gt;&lt;li class="item"&gt;&lt;/li&gt;&lt;li class="item"&gt;&lt;/li&gt;&lt;/ul&gt;</span></pre>
                <h4>
                  <a class="anchor-link" href="#wrap"
                    ><i class="anchor-icon"></i></a
                  ><a class="anchor" name="wrap" id="wrap"></a>wrap
                </h4>
                <pre
                  class="cm-s-default"
                ><span class="cm-builtin">@wrap</span>(<span class="cm-tag">&lt;tag&gt;</span>): <span class="cm-variable">xpath_query</span></pre>
                <p>
                  Wrap each target node in the <code>&lt;tag&gt;</code> tag.
                  Returns a list of the new <code>&lt;tag&gt;</code> elements.
                </p>
                <p><strong>Examples</strong></p>
                <pre
                  class="cm-s-default"
                ><span class="cm-comment"># &lt;em&gt;1&lt;/em&gt;&lt;em&gt;2&lt;/em&gt;</span>
<span class="cm-builtin">@wrap</span>(<span class="cm-tag">&lt;b&gt;</span>): //<span class="cm-tag-2">em</span>
<span class="cm-comment"># &lt;b&gt;&lt;em&gt;1&lt;/em&gt;&lt;/b&gt;&lt;b&gt;&lt;em&gt;2&lt;/em&gt;&lt;/b&gt;</span>
<span class="cm-builtin">@wrap</span>(<span class="cm-tag">&lt;u&gt;</span>)
<span class="cm-comment"># &lt;b&gt;&lt;u&gt;&lt;em&gt;1&lt;/em&gt;&lt;/u&gt;&lt;/b&gt;&lt;b&gt;&lt;u&gt;&lt;em&gt;2&lt;/em&gt;&lt;/u&gt;&lt;/b&gt;</span>
<span class="cm-builtin">@wrap</span>(<span class="cm-tag">&lt;p&gt;</span>): <span class="cm-variable-2">$@</span>
<span class="cm-comment"># &lt;b&gt;&lt;p&gt;&lt;u&gt;&lt;em&gt;1&lt;/em&gt;&lt;/u&gt;&lt;/p&gt;&lt;/b&gt;&lt;b&gt;&lt;p&gt;&lt;u&gt;&lt;em&gt;2&lt;/em&gt;&lt;/u&gt;&lt;/p&gt;&lt;/b&gt;</span></pre>
                <h4>
                  <a class="anchor-link" href="#wrap-inner"
                    ><i class="anchor-icon"></i></a
                  ><a class="anchor" name="wrap-inner" id="wrap-inner"></a
                  >wrap_inner
                </h4>
                <pre
                  class="cm-s-default"
                ><span class="cm-builtin">@wrap_inner</span>(<span class="cm-tag">&lt;tag&gt;</span>): <span class="cm-variable">xpath_query</span></pre>
                <p>
                  Wrap an HTML structure around the content of each target node
                  in the <code>&lt;tag&gt;</code> tag. Returns a list of new
                  <code>&lt;tag&gt;</code> elements.
                </p>
                <p><strong>Examples</strong></p>
                <pre
                  class="cm-s-default"
                ><span class="cm-comment"># &lt;p&gt;H&lt;sub&gt;2&lt;/sub&gt;0&lt;/p&gt;</span>
<span class="cm-builtin">@wrap_inner</span>(<span class="cm-tag">&lt;b&gt;</span>): //<span class="cm-tag-2">p</span>
<span class="cm-comment"># &lt;p&gt;&lt;b&gt;H&lt;sub&gt;2&lt;/sub&gt;0&lt;/b&gt;&lt;/p&gt;</span></pre>
                <h4>
                  <a class="anchor-link" href="#clone"
                    ><i class="anchor-icon"></i></a
                  ><a class="anchor" name="clone" id="clone"></a>clone
                </h4>
                <pre
                  class="cm-s-default"
                ><span class="cm-builtin">@clone</span>: <span class="cm-variable">xpath_query</span></pre>
                <p>
                  Creates a copy of each target node. Returns a list of the
                  newly created nodes.
                </p>
                <p><strong>Examples</strong></p>
                <pre
                  class="cm-s-default"
                ><span class="cm-comment"># &lt;p class="text"&gt;Paragraph&lt;/p&gt;</span>
<span class="cm-builtin">@clone</span>: //<span class="cm-tag-2">p</span>
<span class="cm-comment"># &lt;p class="text"&gt;Paragraph&lt;/p&gt;&lt;p class="text"&gt;Paragraph&lt;/p&gt;</span></pre>
                <h4>
                  <a class="anchor-link" href="#detach"
                    ><i class="anchor-icon"></i></a
                  ><a class="anchor" name="detach" id="detach"></a>detach
                </h4>
                <pre
                  class="cm-s-default"
                ><span class="cm-builtin">@detach</span>: <span class="cm-variable">xpath_query</span></pre>
                <p>
                  Separates the target node from the rest in the parent tag.
                  Creates a copy of the parent tag and wraps the target node
                  into this new instance. Returns a list of parent tags that
                  contain target nodes.
                </p>
                <p><strong>Examples</strong></p>
                <pre
                  class="cm-s-default"
                ><span class="cm-comment"># &lt;a href="#1"&gt;</span>
<span class="cm-comment">#   &lt;b&gt;1&lt;/b&gt;</span>
<span class="cm-comment">#   &lt;p&gt;Link #1&lt;/p&gt;</span>
<span class="cm-comment"># &lt;/a&gt;</span>
<span class="cm-comment"># &lt;a href="#2"&gt;</span>
<span class="cm-comment">#   &lt;b&gt;2&lt;/b&gt;</span>
<span class="cm-comment">#   &lt;p&gt;Link #2&lt;/p&gt;</span>
<span class="cm-comment"># &lt;/a&gt;</span>

<span class="cm-builtin">@detach</span>: //<span class="cm-tag-2">a</span>/<span class="cm-tag-2">b</span>

<span class="cm-comment"># &lt;a href="#1"&gt;</span>
<span class="cm-comment">#   &lt;b&gt;1&lt;/b&gt;</span>
<span class="cm-comment"># &lt;/a&gt;</span>
<span class="cm-comment"># &lt;a href="#1"&gt;</span>
<span class="cm-comment">#   &lt;p&gt;Link #1&lt;/p&gt;</span>
<span class="cm-comment"># &lt;/a&gt;</span>
<span class="cm-comment"># &lt;a href="#2"&gt;</span>
<span class="cm-comment">#   &lt;b&gt;2&lt;/b&gt;</span>
<span class="cm-comment"># &lt;/a&gt;</span>
<span class="cm-comment"># &lt;a href="#2"&gt;</span>
<span class="cm-comment">#   &lt;p&gt;Link #2&lt;/p&gt;</span>
<span class="cm-comment"># &lt;/a&gt;</span>

<span class="cm-builtin">@after</span>(<span class="cm-tag">&lt;br&gt;</span>): <span class="cm-variable-2">$@</span>

<span class="cm-comment"># &lt;a href="#1"&gt;</span>
<span class="cm-comment">#   &lt;b&gt;1&lt;/b&gt;</span>
<span class="cm-comment"># &lt;/a&gt;&lt;br&gt;</span>
<span class="cm-comment"># &lt;a href="#1"&gt;</span>
<span class="cm-comment">#   &lt;p&gt;Link #1&lt;/p&gt;</span>
<span class="cm-comment"># &lt;/a&gt;</span>
<span class="cm-comment"># &lt;a href="#2"&gt;</span>
<span class="cm-comment">#   &lt;b&gt;2&lt;/b&gt;</span>
<span class="cm-comment"># &lt;/a&gt;&lt;br&gt;</span>
<span class="cm-comment"># &lt;a href="#2"&gt;</span>
<span class="cm-comment">#   &lt;p&gt;Link #2&lt;/p&gt;</span>
<span class="cm-comment"># &lt;/a&gt;</span></pre>
                <h4>
                  <a class="anchor-link" href="#split-parent"
                    ><i class="anchor-icon"></i></a
                  ><a class="anchor" name="split-parent" id="split-parent"></a
                  >split_parent
                </h4>
                <pre
                  class="cm-s-default"
                ><span class="cm-builtin">@split_parent</span>: <span class="cm-variable">xpath_query</span></pre>
                <p>
                  Splits the parent tag by the target node. Places preceding
                  siblings wrapped into parent element before the target node.
                  Places following siblings wrapped into parent element placed
                  after target node.
                </p>
                <p>Returns a list of target nodes.</p>
                <p><strong>Examples</strong></p>
                <pre
                  class="cm-s-default"
                ><span class="cm-comment"># &lt;p class="text"&gt;</span>
<span class="cm-comment">#   &lt;b&gt;First&lt;/b&gt; line</span>
<span class="cm-comment">#   &lt;figure&gt;&lt;img src="photo.jpg"&gt;&lt;/figure&gt;</span>
<span class="cm-comment">#   &lt;i&gt;Second&lt;/i&gt; line</span>
<span class="cm-comment"># &lt;/p&gt;</span>
<span class="cm-builtin">@split_parent</span>: //<span class="cm-tag-2">p</span>/<span class="cm-tag-2">figure</span>
<span class="cm-comment"># &lt;p class="text"&gt;</span>
<span class="cm-comment">#   &lt;b&gt;First&lt;/b&gt; line</span>
<span class="cm-comment"># &lt;/p&gt;</span>
<span class="cm-comment"># &lt;figure&gt;&lt;img src="photo.jpg"&gt;&lt;/figure&gt;</span>
<span class="cm-comment"># &lt;p class="text"&gt;</span>
<span class="cm-comment">#   &lt;i&gt;Second&lt;/i&gt; line</span>
<span class="cm-comment"># &lt;/p&gt;</span></pre>
                <h4>
                  <a class="anchor-link" href="#pre"
                    ><i class="anchor-icon"></i></a
                  ><a class="anchor" name="pre" id="pre"></a>pre
                </h4>
                <pre
                  class="cm-s-default"
                ><span class="cm-builtin">@pre</span>: <span class="cm-variable">xpath_query</span></pre>
                <p>
                  Specifies that the text inside the target node is already
                  formatted. Returns a list of matching nodes.
                </p>
                <p><strong>Examples</strong></p>
                <pre
                  class="cm-s-default"
                ><span class="cm-comment"># &lt;p&gt;     Some          text  , &lt;/p&gt;</span>
<span class="cm-comment"># &lt;p&gt;  Some  another      text  &lt;/p&gt;</span>
<span class="cm-builtin">@pre</span>: (//<span class="cm-tag-2">p</span>)[<span class="cm-number">1</span>]
<span class="cm-comment"># Result in the Instant View page:</span>
<span class="cm-comment">#      Some          text  , </span>
<span class="cm-comment"># Some another text</span></pre>
                <h4>
                  <a class="anchor-link" href="#set-attr"
                    ><i class="anchor-icon"></i></a
                  ><a class="anchor" name="set-attr" id="set-attr"></a>set_attr
                </h4>
                <pre
                  class="cm-s-default"
                ><span class="cm-builtin">@set_attr</span>(<span class="cm-variable">attr</span>, <span class="cm-variable">value</span>):       <span class="cm-variable">xpath_query</span>
<span class="cm-builtin">@set_attr</span>(<span class="cm-variable">attr</span>, <span class="cm-attribute">@attr</span>):       <span class="cm-variable">xpath_query</span>
<span class="cm-builtin">@set_attr</span>(<span class="cm-variable">attr</span>, <span class="cm-string">"Some text"</span>): <span class="cm-variable">xpath_query</span>
<span class="cm-builtin">@set_attr</span>(<span class="cm-variable">attr</span>, <span class="cm-string">"Some text"</span>, <span class="cm-attribute">@from-attr</span>, ...): <span class="cm-variable">xpath_query</span></pre>
                <p>
                  Sets an attribute in each matching node. The name of the
                  attribute is passed in the first parameter. The value of the
                  attribute is the rest of the parameters concatenated.
                </p>
                <p>
                  If <code>value</code> has the format <code>@attr</code>, the
                  value of the attribute <code>attr</code> of the target node
                  will be used as the value. <code>value</code> can be an XPath
                  expression that begins with <code>.</code>, in this case the
                  query will be executed relative to the relevant node, and the
                  text value of the returned elements will be used as the
                  attribute's value. Otherwise, <code>value</code> will be used
                  as the attribute's value.
                </p>
                <p>Returns a list of attribute nodes.</p>
                <p><strong>Examples</strong></p>
                <pre
                  class="cm-s-default"
                ><span class="cm-comment"># &lt;p class="a"&gt;&lt;/p&gt;</span>
<span class="cm-builtin">@set_attr</span>(<span class="cm-variable">data-class</span>, <span class="cm-attribute">@class</span>)
<span class="cm-comment"># &lt;p class="a" data-class="a"&gt;&lt;/p&gt;</span>
<span class="cm-builtin">@set_attr</span>(<span class="cm-variable">id</span>, <span class="cm-attribute">@class</span>, <span class="cm-string">"_"</span>, ./<span class="cm-attribute">@data-class</span>)
<span class="cm-comment"># &lt;p class="a" data-class="a" id="a_a"&gt;&lt;/p&gt;</span></pre>
                <h4>
                  <a class="anchor-link" href="#set-attrs"
                    ><i class="anchor-icon"></i></a
                  ><a class="anchor" name="set-attrs" id="set-attrs"></a
                  >set_attrs
                </h4>
                <pre
                  class="cm-s-default"
                ><span class="cm-builtin">@set_attrs</span>(<span class="cm-variable">attr</span>, <span class="cm-variable">value</span>): <span class="cm-variable">xpath_query</span>
<span class="cm-builtin">@set_attrs</span>(<span class="cm-variable">attr</span>, <span class="cm-variable">value</span>[, <span class="cm-variable">attr</span>, <span class="cm-variable">value</span>[, ...]]): <span class="cm-variable">xpath_query</span></pre>
                <p>
                  Sets multiple attributes for each of the target nodes. Each
                  two parameters specify the name and value for the new
                  attributes.
                </p>
                <p>
                  If <code>value</code> has the format <code>@attr</code>, the
                  value of the attribute <code>attr</code> of the target node
                  will be used as the value. <code>value</code> can be an XPath
                  expression that begins with <code>.</code>, in this case the
                  query will be executed relative to the relevant node, and the
                  text value of the returned elements will be used as the
                  attribute's value. Otherwise, <code>value</code> will be used
                  as the attribute's value.
                </p>
                <p>Returns a list of the matching nodes.</p>
                <p><strong>Examples</strong></p>
                <pre
                  class="cm-s-default"
                ><span class="cm-comment"># &lt;p class="a"&gt;&lt;/p&gt;</span>
<span class="cm-builtin">@set_attrs</span>(<span class="cm-variable">data-class</span>, <span class="cm-attribute">@class</span>, <span class="cm-variable">id</span>, <span class="cm-string">"a_a"</span>): //<span class="cm-tag-2">p</span>
<span class="cm-comment"># &lt;p class="a" data-class="a" id="a_a"&gt;&lt;/p&gt;</span></pre>
                <h4>
                  <a class="anchor-link" href="#match"
                    ><i class="anchor-icon"></i></a
                  ><a class="anchor" name="match" id="match"></a>match
                </h4>
                <pre
                  class="cm-s-default"
                ><span class="cm-builtin">@match</span>(<span class="cm-variable">regexp</span>):                         <span class="cm-variable">xpath_query</span>
<span class="cm-builtin">@match</span>(<span class="cm-variable">regexp</span>, <span class="cm-variable">match_index</span>):            <span class="cm-variable">xpath_query</span>
<span class="cm-builtin">@match</span>(<span class="cm-variable">regexp</span>, <span class="cm-variable">match_index</span>, <span class="cm-variable">modifiers</span>): <span class="cm-variable">xpath_query</span></pre>
                <p>
                  Performs a search based on a regular expression. Replaces the
                  content of the target node with the search result. The second
                  parameter specifies the number of the captured parenthesized
                  subpattern. If this is not specified, the text that matched
                  the full pattern will be used. You can specify modifiers for
                  the regular expression using the optional parameter (<a
                    href="http://pcre.org/pcre.txt"
                    >ims modifiers</a
                  >
                  are supported).
                </p>
                <p>
                  Returns a list of target nodes. As of IV <strong>2.1</strong>,
                  returns a list of target nodes the content of which matched
                  the regular expression.
                </p>
                <p><strong>Examples</strong></p>
                <pre
                  class="cm-s-default"
                ><span class="cm-comment"># &lt;p class="plainText"&gt;Hello, world!&lt;/p&gt;</span>
<span class="cm-builtin">@match</span>(<span class="cm-string">"[a-z]+!"</span>): //<span class="cm-tag-2">p</span>
<span class="cm-comment"># &lt;p class="plainText"&gt;world!&lt;/p&gt;</span>
<span class="cm-builtin">@match</span>(<span class="cm-string">"([a-z]+)!"</span>, <span class="cm-number">1</span>): //<span class="cm-tag-2">p</span>/<span class="cm-tag-2">text</span>()
<span class="cm-comment"># &lt;p class="plainText"&gt;world&lt;/p&gt;</span>
<span class="cm-builtin">@match</span>(<span class="cm-string">"..t"</span>, <span class="cm-number">0</span>, <span class="cm-string">"i"</span>): //<span class="cm-tag-2">p</span>/<span class="cm-attribute">@class</span>
<span class="cm-comment"># &lt;p class="inT"&gt;Bye, world!&lt;/p&gt;</span>

<span class="cm-comment"># &lt;ul&gt;&lt;li&gt;a1&lt;/li&gt;&lt;li&gt;a&lt;/li&gt;&lt;li&gt;21b&lt;/li&gt;&lt;li&gt;.&lt;/li&gt;&lt;/ul&gt;</span>
<span class="cm-builtin">@match</span>(<span class="cm-string">"[0-9]+"</span>): //<span class="cm-tag-2">ul</span>/<span class="cm-tag-2">li</span>
<span class="cm-comment"># &lt;ul&gt;&lt;li&gt;1&lt;/li&gt;&lt;li&gt;&lt;/li&gt;&lt;li&gt;21&lt;/li&gt;&lt;li&gt;&lt;/li&gt;&lt;/ul&gt;</span>
<span class="cm-builtin">@debug</span>: <span class="cm-variable-2">$@</span>
<span class="cm-comment"># Debug 2 nodes:</span>
<span class="cm-comment">#   [0]: &lt;li&gt;1&lt;/li&gt;</span>
<span class="cm-comment">#   [1]: &lt;li&gt;21&lt;/li&gt;</span></pre>
                <h4>
                  <a class="anchor-link" href="#replace"
                    ><i class="anchor-icon"></i></a
                  ><a class="anchor" name="replace" id="replace"></a>replace
                </h4>
                <pre
                  class="cm-s-default"
                ><span class="cm-builtin">@replace</span>(<span class="cm-variable">regexp</span>, <span class="cm-variable">replacement</span>):            <span class="cm-variable">xpath_query</span>
<span class="cm-builtin">@replace</span>(<span class="cm-variable">regexp</span>, <span class="cm-variable">replacement</span>, <span class="cm-variable">modifiers</span>): <span class="cm-variable">xpath_query</span></pre>
                <p>
                  Performs a search and replace operation using the regular
                  expression. You can specify modifiers for the regular
                  expression using the optional parameter (<a
                    href="http://pcre.org/pcre.txt"
                    >ims modifiers</a
                  >
                  are supported).
                </p>
                <p>
                  Returns a list of target nodes. As of IV <strong>2.1</strong>,
                  returns a list of target nodes the content of which was
                  replaced by the regular expression.
                </p>
                <p><strong>Examples</strong></p>
                <pre
                  class="cm-s-default"
                ><span class="cm-comment"># &lt;p class="text"&gt;Hello, world!&lt;/p&gt;</span>
<span class="cm-builtin">@replace</span>(<span class="cm-string">"Hello"</span>, <span class="cm-string">"Goodbye"</span>): //<span class="cm-tag-2">p</span>/<span class="cm-tag-2">text</span>()
<span class="cm-comment"># &lt;p class="text"&gt;Goodbye, world!&lt;/p&gt;</span>
<span class="cm-builtin">@replace</span>(<span class="cm-string">".t$"</span>, <span class="cm-string">"mp"</span>): //<span class="cm-tag-2">p</span>/<span class="cm-attribute">@class</span>
<span class="cm-comment"># &lt;p class="temp"&gt;Goodbye, world!&lt;/p&gt;</span>
<span class="cm-builtin">@replace</span>(<span class="cm-string">"goodb"</span>, <span class="cm-string">"B"</span>, <span class="cm-string">"i"</span>): //<span class="cm-tag-2">p</span>/<span class="cm-tag-2">text</span>()
<span class="cm-comment"># &lt;p class="temp"&gt;Bye, world!&lt;/p&gt;</span>

<span class="cm-comment"># &lt;ul&gt;&lt;li&gt;a1&lt;/li&gt;&lt;li&gt;a&lt;/li&gt;&lt;li&gt;21b&lt;/li&gt;&lt;li&gt;.&lt;/li&gt;&lt;/ul&gt;</span>
<span class="cm-builtin">@replace</span>(<span class="cm-string">"[0-9]+"</span>, <span class="cm-string">"($0)"</span>): //<span class="cm-tag-2">ul</span>/<span class="cm-tag-2">li</span>
<span class="cm-comment"># &lt;ul&gt;&lt;li&gt;a(1)&lt;/li&gt;&lt;li&gt;a&lt;/li&gt;&lt;li&gt;(21)b&lt;/li&gt;&lt;li&gt;.&lt;/li&gt;&lt;/ul&gt;</span>
<span class="cm-builtin">@debug</span>: <span class="cm-variable-2">$@</span>
<span class="cm-comment"># Debug 2 nodes:</span>
<span class="cm-comment">#   [0]: &lt;li&gt;a(1)&lt;/li&gt;</span>
<span class="cm-comment">#   [1]: &lt;li&gt;(21)b&lt;/li&gt;</span></pre>
                <h4>
                  <a class="anchor-link" href="#urlencode"
                    ><i class="anchor-icon"></i></a
                  ><a class="anchor" name="urlencode" id="urlencode"></a
                  >urlencode
                </h4>
                <pre
                  class="cm-s-default"
                ><span class="cm-builtin">@urlencode</span>: <span class="cm-variable">xpath_query</span></pre>
                <p>
                  Encodes the content of the target node as per RFC 3986.
                  Returns target nodes.
                </p>
                <p><strong>Examples</strong></p>
                <pre
                  class="cm-s-default"
                ><span class="cm-comment"># &lt;a href="https://telegram.org"&gt;link&lt;/a&gt;</span>
<span class="cm-variable-2">$a</span>: //<span class="cm-tag-2">a</span>
<span class="cm-builtin">@urlencode</span>: <span class="cm-variable-2">$a</span>/<span class="cm-attribute">@href</span>
<span class="cm-comment"># &lt;a href="https%3A%2F%2Ftelegram.org"&gt;link&lt;/a&gt;</span>
<span class="cm-builtin">@set_attr</span>(<span class="cm-variable">href</span>, <span class="cm-string">"/?url="</span>, <span class="cm-attribute">@href</span>): <span class="cm-variable-2">$a</span>
<span class="cm-comment"># &lt;a href="/?url=https%3A%2F%2Ftelegram.org"&gt;link&lt;/a&gt;</span></pre>
                <h4>
                  <a class="anchor-link" href="#urldecode"
                    ><i class="anchor-icon"></i></a
                  ><a class="anchor" name="urldecode" id="urldecode"></a
                  >urldecode
                </h4>
                <pre
                  class="cm-s-default"
                ><span class="cm-builtin">@urldecode</span>: <span class="cm-variable">xpath_query</span></pre>
                <p>
                  Decodes the content of the target node as per RFC 3986.
                  Returns target nodes.
                </p>
                <p><strong>Examples</strong></p>
                <pre
                  class="cm-s-default"
                ><span class="cm-comment"># &lt;a href="/?url=https%3A%2F%2Ftelegram.org"&gt;link&lt;/a&gt;</span>
<span class="cm-variable-2">$a</span>: //<span class="cm-tag-2">a</span>
<span class="cm-builtin">@match</span>(<span class="cm-string">"^/\?url=(.+)$"</span>, <span class="cm-number">1</span>): <span class="cm-variable-2">$a</span>/<span class="cm-attribute">@href</span>
<span class="cm-comment"># &lt;a href="https%3A%2F%2Ftelegram.org"&gt;link&lt;/a&gt;</span>
<span class="cm-builtin">@urldecode</span>
<span class="cm-comment"># &lt;a href="https://telegram.org"&gt;link&lt;/a&gt;</span></pre>
                <h4>
                  <a class="anchor-link" href="#htmlencode"
                    ><i class="anchor-icon"></i></a
                  ><a class="anchor" name="htmlencode" id="htmlencode"></a
                  >htmlencode
                </h4>
                <pre
                  class="cm-s-default"
                ><span class="cm-builtin">@htmlencode</span>: <span class="cm-variable">xpath_query</span></pre>
                <p>
                  Convert special characters in the target node to HTML
                  entities. Returns the target nodes.
                </p>
                <p><strong>Examples</strong></p>
                <pre
                  class="cm-s-default"
                ><span class="cm-comment"># &lt;p&gt;&amp;lt;b&amp;gt;Some text&amp;lt;\b&amp;gt;&lt;/p&gt;</span>
<span class="cm-builtin">@htmlencode</span>: //<span class="cm-tag-2">p</span>
<span class="cm-comment"># &lt;p&gt;&amp;amp;lt;b&amp;amp;gt;Some text&amp;amp;lt;\b&amp;amp;gt;&lt;/p&gt;</span></pre>
                <h4>
                  <a class="anchor-link" href="#htmldecode"
                    ><i class="anchor-icon"></i></a
                  ><a class="anchor" name="htmldecode" id="htmldecode"></a
                  >htmldecode
                </h4>
                <pre
                  class="cm-s-default"
                ><span class="cm-builtin">@htmldecode</span>: <span class="cm-variable">xpath_query</span></pre>
                <p>
                  Convert special HTML entities in the target node back to
                  characters. Returns the target nodes.
                </p>
                <p><strong>Examples</strong></p>
                <pre
                  class="cm-s-default"
                ><span class="cm-comment"># &lt;p&gt;&amp;amp;lt;b&amp;amp;gt;Some text&amp;amp;lt;\b&amp;amp;gt;&lt;/p&gt;</span>
<span class="cm-builtin">@htmldecode</span>: //<span class="cm-tag-2">p</span>
<span class="cm-comment"># &lt;p&gt;&amp;lt;b&amp;gt;Some text&amp;lt;\b&amp;gt;&lt;/p&gt;</span></pre>
                <h4>
                  <a class="anchor-link" href="#style-to-attrs"
                    ><i class="anchor-icon"></i></a
                  ><a
                    class="anchor"
                    name="style-to-attrs"
                    id="style-to-attrs"
                  ></a
                  >style_to_attrs
                </h4>
                <pre
                  class="cm-s-default"
                ><span class="cm-builtin">@style_to_attrs</span>(<span class="cm-variable">css_prop</span>, <span class="cm-variable">attr</span>): <span class="cm-variable">xpath_query</span>
<span class="cm-builtin">@style_to_attrs</span>(<span class="cm-variable">css_prop</span>, <span class="cm-variable">attr</span>[, <span class="cm-variable">css_prop</span>, <span class="cm-variable">attr</span>[, ...]]): <span class="cm-variable">xpath_query</span></pre>
                <p>
                  Gets a value of a CSS property from the style attribute and
                  sets it into an attribute for each of the target nodes. Each
                  two parameters specify the name for the new attribute and the
                  name of CSS property. Returns a list of matching nodes.
                </p>
                <p><strong>Examples</strong></p>
                <pre
                  class="cm-s-default"
                ><span class="cm-comment"># &lt;img style="width: 20px; height: 20px"&gt;</span>
<span class="cm-builtin">@style_to_attrs</span>(<span class="cm-variable">width</span>, <span class="cm-variable">data-width</span>, <span class="cm-variable">height</span>, <span class="cm-variable">data-height</span>): //<span class="cm-tag-2">img</span>
<span class="cm-comment"># &lt;img style="width: 20px; height: 20px" data-width="20" data-height="20"&gt;</span></pre>
                <h4>
                  <a class="anchor-link" href="#background-to-image"
                    ><i class="anchor-icon"></i></a
                  ><a
                    class="anchor"
                    name="background-to-image"
                    id="background-to-image"
                  ></a
                  >background_to_image
                </h4>
                <pre
                  class="cm-s-default"
                ><span class="cm-builtin">@background_to_image</span>: <span class="cm-variable">xpath_query</span></pre>
                <p>
                  Transforms the target node with a background picture into an
                  <code>&lt;img&gt;</code> tag with an
                  <code>src</code> attribute. The target node must contain a
                  <code>style</code> attribute with the background. Returns a
                  list of transformed nodes.
                </p>
                <p><strong>Examples</strong></p>
                <pre
                  class="cm-s-default"
                ><span class="cm-comment"># &lt;div class="bg_image" style="background-image:url(image.jpg)"&gt;&lt;/div&gt;</span>
<span class="cm-builtin">@background_to_image</span>: //<span class="cm-tag-2">div</span>[<span class="cm-variable">has-class</span>(<span class="cm-string">"bg_image"</span>)]
<span class="cm-comment"># &lt;img src="image.jpg"&gt;</span></pre>
                <h4>
                  <a class="anchor-link" href="#json-to-xml"
                    ><i class="anchor-icon"></i></a
                  ><a class="anchor" name="json-to-xml" id="json-to-xml"></a
                  >json_to_xml
                </h4>
                <pre
                  class="cm-s-default"
                ><span class="cm-builtin">@json_to_xml</span>: <span class="cm-variable">xpath_query</span></pre>
                <p>
                  Transforms the content of the target node to the XML format.
                  The contents must be in valid JSON format. The resulting XML
                  tree will be inserted into the document. Returns the root
                  element of the XML tree.
                </p>
                <p><strong>Examples</strong></p>
                <pre
                  class="cm-s-default"
                ><span class="cm-comment"># &lt;div data-var='{"a":1,"b":[1,2],"c":{"p":"Hello!"}}'&gt;&lt;/div&gt;</span>
<span class="cm-builtin">@json_to_xml</span>: //<span class="cm-tag-2">div</span>/<span class="cm-attribute">@data-var</span>
<span class="cm-builtin">@debug</span>: <span class="cm-variable-2">$@</span>
<span class="cm-comment"># &lt;xml&gt;&lt;a&gt;1&lt;/a&gt;&lt;b&gt;&lt;item&gt;1&lt;/item&gt;&lt;item&gt;2&lt;/item&gt;&lt;/b&gt;&lt;c&gt;&lt;p&gt;Hello!&lt;/p&gt;&lt;/c&gt;&lt;/xml&gt;</span></pre>
                <h4>
                  <a class="anchor-link" href="#html-to-dom"
                    ><i class="anchor-icon"></i></a
                  ><a class="anchor" name="html-to-dom" id="html-to-dom"></a
                  >html_to_dom
                </h4>
                <pre
                  class="cm-s-default"
                ><span class="cm-builtin">@html_to_dom</span>: <span class="cm-variable">xpath_query</span></pre>
                <p>
                  Parse the content of the target node in HTML format and insert
                  it into the document. Returns the root element of the inserted
                  HTML tree.
                </p>
                <p><strong>Examples</strong></p>
                <pre
                  class="cm-s-default"
                ><span class="cm-comment"># &lt;div data-content="&amp;lt;b&amp;gt;Some text&amp;lt;\b&amp;gt;"&gt;&lt;/div&gt;</span>
<span class="cm-builtin">@html_to_dom</span>: //<span class="cm-tag-2">div</span>/<span class="cm-attribute">@data-content</span>
<span class="cm-builtin">@debug</span>: <span class="cm-variable-2">$@</span>
<span class="cm-comment"># &lt;dom&gt;&lt;b&gt;Some text&lt;/b&gt;&lt;/dom&gt;</span></pre>
                <h4>
                  <a class="anchor-link" href="#combine"
                    ><i class="anchor-icon"></i></a
                  ><a class="anchor" name="combine" id="combine"></a>combine
                </h4>
                <pre
                  class="cm-s-default"
                ><span class="cm-builtin">@combine</span>:                        <span class="cm-variable">xpath_query</span>
<span class="cm-builtin">@combine</span>(<span class="cm-string">" - "</span>):                 <span class="cm-variable">xpath_query</span>
<span class="cm-builtin">@combine</span>(<span class="cm-tag">&lt;tag&gt;</span>):                 <span class="cm-variable">xpath_query</span>
<span class="cm-builtin">@combine</span>(<span class="cm-tag">&lt;tag&gt;</span>[, <span class="cm-string">" - "</span>[, ...]]): <span class="cm-variable">xpath_query</span></pre>
                <p>
                  Combines each target node with its preceding node if such a
                  node exists. You can use parameters to specify nodes to be
                  inserted above the target node. If the parameter is in angular
                  brackets, a new <code>&lt;tag&gt;</code> node will be created.
                  Otherwise a text element with the text specified by the
                  parameter will be used.
                </p>
                <p>Returns a list of nodes, preceding the target nodes.</p>
                <p><strong>Examples</strong></p>
                <pre
                  class="cm-s-default"
                ><span class="cm-comment"># &lt;pre&gt;1 2 3&lt;/pre&gt;</span>
<span class="cm-comment"># &lt;pre&gt; 4 5 &lt;/pre&gt;</span>
<span class="cm-comment"># &lt;pre&gt;6 7 8&lt;/pre&gt;</span>
<span class="cm-builtin">@combine</span>:             //<span class="cm-tag-2">pre</span>/following-sibling::<span class="cm-tag-2">*</span>[<span class="cm-number">1</span>]/self::<span class="cm-tag-2">pre</span>
<span class="cm-comment"># &lt;pre&gt;1 2 3 4 5 6 7 8&lt;/pre&gt;</span>

<span class="cm-comment"># &lt;p&gt;first&lt;/p&gt;</span>
<span class="cm-comment"># &lt;p&gt;second&lt;/p&gt;</span>
<span class="cm-builtin">@combine</span>(<span class="cm-tag">&lt;br&gt;</span>, <span class="cm-tag">&lt;br&gt;</span>): //<span class="cm-tag-2">p</span>/following-sibling::<span class="cm-tag-2">*</span>[<span class="cm-number">1</span>]/self::<span class="cm-tag-2">p</span>
<span class="cm-comment"># &lt;p&gt;first&lt;br&gt;&lt;br&gt;second&lt;/p&gt;</span>

<span class="cm-comment"># &lt;h1&gt;Title&lt;/h1&gt;</span>
<span class="cm-comment"># &lt;strong&gt;Subtitle&lt;/strong&gt;</span>
<span class="cm-builtin">@combine</span>(<span class="cm-tag">&lt;br&gt;</span>, <span class="cm-string">"\n"</span>): //<span class="cm-tag-2">h1</span>/following-sibling::<span class="cm-tag-2">*</span>[<span class="cm-number">1</span>]/self::<span class="cm-tag-2">strong</span>
<span class="cm-comment"># &lt;h1&gt;Title&lt;br&gt;</span>
<span class="cm-comment"># Subtitle&lt;/h1&gt;</span></pre>
                <h4>
                  <a class="anchor-link" href="#datetime"
                    ><i class="anchor-icon"></i></a
                  ><a class="anchor" name="datetime" id="datetime"></a>datetime
                </h4>
                <pre
                  class="cm-s-default"
                ><span class="cm-builtin">@datetime</span>(<span class="cm-number">-2</span>): <span class="cm-variable">xpath_query</span>
<span class="cm-builtin">@datetime</span>(<span class="cm-number">-2</span>, <span class="cm-string">"en-US"</span>, <span class="cm-string">"yyyy-MM-dd"</span>): <span class="cm-variable">xpath_query</span></pre>
                <p>
                  Transforms the date and time from the text of the target node
                  into a unixtime timestamp. The parameter specifies the
                  timezone of the original date and time.
                </p>
                <p>
                  You can also pass a locale and a pattern to parse the date and
                  time in more complicated cases. If a non-gregorian calendar is
                  used, this needs to be specified in the locale. For example,
                  <code>"fa-IR@calendar=persian"</code>. Available patterns are
                  documented
                  <a
                    href="http://userguide.icu-project.org/formatparse/datetime#TOC-Date-Time-Format-Syntax"
                    >here</a
                  >.
                </p>
                <p>
                  On success, returns a text element with the unixtime
                  timestamp. Otherwise, returns the target element.
                </p>
                <p><strong>Examples</strong></p>
                <pre
                  class="cm-s-default"
                ><span class="cm-comment"># &lt;div id="date"&gt;1 January 2017, 15:04&lt;/div&gt;</span>
<span class="cm-builtin">@datetime</span>(<span class="cm-number">-2</span>):  //<span class="cm-tag-2">div</span>[<span class="cm-attribute">@id</span>=<span class="cm-string">"date"</span>]
<span class="cm-variable-2">published_date</span>: <span class="cm-variable-2">$@</span>   <span class="cm-comment"># the property published_date will hold a unixtime timestamp</span>

<span class="cm-comment"># &lt;time&gt;دوشنبه, ۲۳ اسفند ۱۳۹۵&lt;/time&gt;</span>
<span class="cm-builtin">@datetime</span>(<span class="cm-number">0</span>, <span class="cm-string">"fa-IR@calendar=persian"</span>, <span class="cm-string">"EEEE, dd MMMM yyyy"</span>): //<span class="cm-tag-2">time</span>
<span class="cm-variable-2">published_date</span>: <span class="cm-variable-2">$@</span>   <span class="cm-comment"># the property published_date will hold a unixtime timestamp</span></pre>
                <h4>
                  <a class="anchor-link" href="#simplify"
                    ><i class="anchor-icon"></i></a
                  ><a class="anchor" name="simplify" id="simplify"></a>simplify
                </h4>
                <blockquote>
                  <p>
                    <strong>Note:</strong> This is a service function. There is
                    no reason for you to use it in your templates. It was
                    included in this reference to give you a better
                    understanding of how the system works (see the
                    <code>..after</code> block).
                  </p>
                </blockquote>
                <pre
                  class="cm-s-default"
                ><span class="cm-builtin">@simplify</span>: <span class="cm-variable">xpath_query</span></pre>
                <p>
                  Processes the target nodes according to the Instant View
                  format. Returns the target nodes.
                </p>
                <p><strong>Examples</strong></p>
                <pre
                  class="cm-s-default"
                ><span class="cm-comment"># &lt;p&gt;&lt;span&gt;&lt;b&gt;S&lt;/b&gt;ome&lt;/span&gt; &lt;em&gt;important&lt;/em&gt; text!&lt;/p&gt;</span>
<span class="cm-builtin">@simplify</span>: //<span class="cm-tag-2">p</span>
<span class="cm-comment"># &lt;p&gt;&lt;b&gt;S&lt;/b&gt;ome &lt;em&gt;important&lt;/em&gt; text!&lt;/p&gt;</span></pre>
                <h4>
                  <a class="anchor-link" href="#inline"
                    ><i class="anchor-icon"></i></a
                  ><a class="anchor" name="inline" id="inline"></a>inline
                </h4>
                <pre
                  class="cm-s-default"
                ><span class="cm-builtin">@inline</span>:         <span class="cm-variable">xpath_query</span>
<span class="cm-builtin">@inline</span>(<span class="cm-variable">silent</span>): <span class="cm-variable">xpath_query</span></pre>
                <p>
                  If the target element is an <code>&lt;iframe&gt;</code> with
                  the attribute <code>src</code>, the content of the iframe will
                  be loaded. The target element will be replaced with the
                  content of the iframe.
                </p>
                <p>
                  If the target node is an HTML-comment, a
                  <code>&lt;comment&gt;</code> element with the content of the
                  comment will be created. The comment will be replaced by the
                  newly created node.
                </p>
                <p>
                  You can use <code>silent</code> parameter to ignore errors
                  while processing this function. You will still see an error in
                  the debug console, but the rules that come after will continue
                  to execute.
                </p>
                <p>Returns a list of replaced nodes.</p>
                <blockquote>
                  <p>
                    Note: The @inline function adheres to the
                    <a href="https://en.wikipedia.org/wiki/Same-origin_policy"
                      >same-origin policy</a
                    >. This means that the target and the inlined pages should
                    have the same origin. You can specify additional allowed
                    origins using the option
                    <a href="#allowed-origin-new">~allowed_origin</a>
                  </p>
                </blockquote>
                <p><strong>Examples</strong></p>
                <pre
                  class="cm-s-default"
                ><span class="cm-comment"># &lt;p&gt;&lt;iframe src="/subpage.html"&gt;&lt;/iframe&gt;&lt;/p&gt;</span>
<span class="cm-comment"># /subpage.html:</span>
<span class="cm-comment">#   &lt;html&gt;&lt;body&gt;&lt;p&gt;Hello!&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;</span>
<span class="cm-builtin">@inline</span>: //<span class="cm-tag-2">p</span>/<span class="cm-tag-2">iframe</span>
<span class="cm-comment"># &lt;p&gt;&lt;html&gt;&lt;body&gt;&lt;p&gt;Hello!&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;&lt;/p&gt;</span>
<span class="cm-builtin">@debug</span>
<span class="cm-comment"># &lt;html&gt;&lt;body&gt;&lt;p&gt;Hello!&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;</span>

<span class="cm-comment"># &lt;p&gt;&lt;!--&lt;b&gt;Hello!&lt;/b&gt;, world!--&gt;&lt;/p&gt;</span>
<span class="cm-builtin">@inline</span>: //<span class="cm-tag-2">p</span>/<span class="cm-tag-2">comment</span>()
<span class="cm-comment"># &lt;p&gt;&lt;comment&gt;&lt;b&gt;Hello!&lt;/b&gt;, world!&lt;/comment&gt;&lt;/p&gt;</span>
<span class="cm-builtin">@debug</span>
<span class="cm-comment"># &lt;comment&gt;&lt;b&gt;Hello!&lt;/b&gt;, world!&lt;/comment&gt;</span></pre>
                <h4>
                  <a class="anchor-link" href="#load-new"
                    ><i class="anchor-icon"></i></a
                  ><a class="anchor" name="load-new" id="load-new"></a>load
                  <sup
                    ><mark><strong>NEW</strong></mark></sup
                  >
                </h4>
                <pre
                  class="cm-s-default"
                ><span class="cm-builtin">@load</span>:         <span class="cm-string">"https://example.com"</span>
<span class="cm-builtin">@load</span>(<span class="cm-variable">silent</span>): <span class="cm-variable">xpath_query</span></pre>
                <p>
                  Loads the content of the URL. The URL can be specified as a
                  string or be the content of the target node.
                </p>
                <p>
                  You can use <code>silent</code> parameter to ignore errors
                  while processing this function. You will still see an error in
                  the debug console, but the rules that come after will continue
                  to execute.
                </p>
                <p>Returns the newly created node with loaded content.</p>
                <blockquote>
                  <p>
                    Note: The @load function adheres to the
                    <a href="https://en.wikipedia.org/wiki/Same-origin_policy"
                      >same-origin policy</a
                    >. This means that the target and the loaded pages should
                    have the same origin. You can specify additional allowed
                    origins using the option
                    <a href="#allowed-origin-new">~allowed_origin</a>
                  </p>
                </blockquote>
                <p><strong>Examples</strong></p>
                <pre
                  class="cm-s-default"
                ><span class="cm-builtin">@append</span>(<span class="cm-tag">&lt;iframe&gt;</span> <span class="cm-variable">src</span> <span class="cm-string">"/subpage.html"</span>): /<span class="cm-tag-2">html</span>/<span class="cm-tag-2">body</span>
<span class="cm-variable-2">$iframe</span>: <span class="cm-variable-2">$@</span>
<span class="cm-builtin">@remove</span>
<span class="cm-builtin">@inline</span>: <span class="cm-variable-2">$iframe</span>
<span class="cm-comment"># the same, but much shorter</span>
<span class="cm-builtin">@load</span>: <span class="cm-string">"/subpage.html"</span>

<span class="cm-builtin">@load</span>(<span class="cm-variable">silent</span>): //<span class="cm-tag-2">meta</span>[<span class="cm-attribute">@property</span>=<span class="cm-string">"api:url"</span>]/<span class="cm-attribute">@content</span>
<span class="cm-comment"># trying to load content from api:url</span>
<span class="cm-builtin">@if</span> ( <span class="cm-variable-2">$@</span> ) {
  <span class="cm-comment"># Do something with content</span>
}</pre>
                <h4>
                  <a class="anchor-link" href="#unsupported"
                    ><i class="anchor-icon"></i></a
                  ><a class="anchor" name="unsupported" id="unsupported"></a
                  >unsupported
                </h4>
                <pre
                  class="cm-s-default"
                ><span class="cm-builtin">@unsupported</span>: <span class="cm-variable">xpath_query</span></pre>
                <p>
                  Specifies that the target node contains essential content that
                  can't be represented in the Instant View format. Returns the
                  target nodes.
                </p>
                <p><strong>Examples</strong></p>
                <pre
                  class="cm-s-default"
                ><span class="cm-comment"># &lt;p&gt;See the graph below:&lt;/p&gt;</span>
<span class="cm-comment"># &lt;canvas class="article_graph" width="600" height="400"&gt;&lt;/canvas&gt;</span>
<span class="cm-builtin">@unsupported</span>: //<span class="cm-tag-2">canvas</span>[<span class="cm-variable">has-class</span>(<span class="cm-string">"article_graph"</span>)]</pre>
                <blockquote>
                  <p>
                    <strong>Tip:</strong> It is important to identify that a
                    page contains essential unsupported content — no IV page
                    will be generated to ensure that the user never gets
                    incomplete info from an article. The system will take care
                    of the most popular cases in the <code>..after</code> block,
                    but your template must cover everything that the system
                    doesn't catch.
                  </p>
                </blockquote>
                <h3>
                  <a class="anchor-link" href="#supported-block-functions"
                    ><i class="anchor-icon"></i></a
                  ><a
                    class="anchor"
                    name="supported-block-functions"
                    id="supported-block-functions"
                  ></a
                  >Supported block functions
                </h3>
                <p>The general format for a block function is the following:</p>
                <pre
                  class="cm-s-default"
                ><span class="cm-builtin">@function</span>(<span class="cm-variable">xpath_query</span>) {
  <span class="cm-comment"># block of rules</span>
}</pre>
                <p>
                  Block functions usually accept the list of nodes returned by
                  the XPath statement as a parameter. Depending on the function
                  and its parameters, rules inside the block can be run several
                  times or never. Block functions can contain any type of rules
                  except conditions.
                </p>
                <p>
                  Below is a list of block functions that are supported in
                  Instant View rules.
                </p>
                <h4>
                  <a class="anchor-link" href="#if"
                    ><i class="anchor-icon"></i></a
                  ><a class="anchor" name="if" id="if"></a>if
                </h4>
                <pre
                  class="cm-s-default"
                ><span class="cm-builtin">@if</span>(<span class="cm-variable">xpath_query</span>) {
  <span class="cm-comment"># block of rules</span>
}</pre>
                <p>
                  Executes the block of rules if target nodes exist on the
                  current page. If target nodes do not exist, the block of rules
                  will be skipped. The <code>$$</code> and
                  <code>$@</code> variables contain target nodes found by the
                  XPath query.
                </p>
                <p><strong>Example</strong></p>
                <pre
                  class="cm-s-default"
                ><span class="cm-builtin">@if</span>( //<span class="cm-tag-2">div</span>[<span class="cm-variable">has-class</span>(<span class="cm-string">"blockquote"</span>)] ) { <span class="cm-comment"># if div.blockquote exists</span>
  <span class="cm-tag">&lt;blockquote&gt;</span>: <span class="cm-variable-2">$@</span>                      <span class="cm-comment">#   change tag name to blockquote</span>
  <span class="cm-tag">&lt;cite&gt;</span>: <span class="cm-variable-2">$@</span>//<span class="cm-tag-2">div</span>[<span class="cm-variable">has-class</span>(<span class="cm-string">"author"</span>)]  <span class="cm-comment">#   and mark div.author as a caption</span>
}</pre>
                <h4>
                  <a class="anchor-link" href="#if-not"
                    ><i class="anchor-icon"></i></a
                  ><a class="anchor" name="if-not" id="if-not"></a>if_not
                </h4>
                <pre
                  class="cm-s-default"
                ><span class="cm-builtin">@if_not</span>(<span class="cm-variable">xpath_query</span>) {
  <span class="cm-comment"># block of rules</span>
}</pre>
                <p>
                  Executes a block of rules if target nodes do not exist on the
                  current page. If such nodes exist, the block of rules will be
                  skipped. The <code>$$</code> and <code>$@</code> variables
                  contain target nodes found by the XPath query.
                </p>
                <p><strong>Example</strong></p>
                <pre
                  class="cm-s-default"
                ><span class="cm-builtin">@if_not</span>( <span class="cm-variable-2">$body</span>//<span class="cm-tag-2">footer</span> ) {     <span class="cm-comment"># if footer does not exist</span>
  <span class="cm-builtin">@append</span>(<span class="cm-tag">&lt;footer&gt;</span>): <span class="cm-variable-2">$body</span>     <span class="cm-comment">#   append it into body</span>
}</pre>
                <h4>
                  <a class="anchor-link" href="#map"
                    ><i class="anchor-icon"></i></a
                  ><a class="anchor" name="map" id="map"></a>map
                </h4>
                <pre
                  class="cm-s-default"
                ><span class="cm-builtin">@map</span>(<span class="cm-variable">xpath_query</span>) {
  <span class="cm-comment"># block of rules</span>
}</pre>
                <p>
                  Executes a block of rules once per each target node found by
                  the XPath query. At the beginning of each iteration, the
                  following variables will be set:
                </p>
                <ul>
                  <li>
                    <code>$$</code> will contain the target nodes found by XPath
                    query;
                  </li>
                  <li><code>$@</code> will contain the current target node;</li>
                  <li>
                    <code>$index</code> will contain the index of the current
                    target node (starts with 1);
                  </li>
                  <li>
                    <code>$first</code> will contain
                    <code>&lt;true&gt;</code> if the current target node is the
                    first in the list and an empty list otherwise;
                  </li>
                  <li>
                    <code>$middle</code> will contain
                    <code>&lt;true&gt;</code> if the current target node is
                    between the first and the last in the list, empty list
                    otherwise;
                  </li>
                  <li>
                    <code>$last</code> would contain
                    <code>&lt;true&gt;</code> if the current target node is the
                    last one in the list, empty list otherwise.
                  </li>
                </ul>
                <p><strong>Example</strong></p>
                <pre
                  class="cm-s-default"
                ><span class="cm-builtin">@map</span>( //<span class="cm-tag-2">div</span>[<span class="cm-attribute">@id</span>=<span class="cm-string">"list"</span>]/<span class="cm-tag-2">p</span> ) {   <span class="cm-comment"># for each paragraph in list</span>
  <span class="cm-variable-2">$p</span>: <span class="cm-variable-2">$@</span>                        <span class="cm-comment">#   store the current paragraph in $p variable</span>
  <span class="cm-builtin">@prepend_to</span>(<span class="cm-variable-2">$p</span>): <span class="cm-string">". "</span>         <span class="cm-comment">#   and</span>
  <span class="cm-builtin">@prepend_to</span>(<span class="cm-variable-2">$p</span>): <span class="cm-variable-2">$index</span>       <span class="cm-comment">#   number them starting with 1</span>
}</pre>
                <blockquote>
                  <p>
                    Please note that the <code>@map</code> function should be
                    used <strong>only</strong> if it is impossible to use
                    <strong>regular functions</strong> with xpath queries (for
                    example you need to use $index). Otherwise, regular
                    functions are faster because they process several nodes at
                    once.
                  </p>
                </blockquote>
                <p><strong>Example</strong></p>
                <pre
                  class="cm-s-default"
                ><span class="cm-comment"># Bad way:</span>
<span class="cm-builtin">@map</span>( //<span class="cm-tag-2">div</span>[<span class="cm-variable">has-class</span>(<span class="cm-string">"image"</span>)] ) {
  <span class="cm-variable-2">$image</span>: <span class="cm-variable-2">$@</span>
  <span class="cm-tag">&lt;cite&gt;</span>:       <span class="cm-variable-2">$image</span>//<span class="cm-tag-2">p</span>/<span class="cm-tag-2">span</span>
  <span class="cm-tag">&lt;figcaption&gt;</span>: <span class="cm-variable-2">$image</span>//<span class="cm-tag-2">p</span>
  <span class="cm-tag">&lt;figure&gt;</span>:     <span class="cm-variable-2">$image</span>
}
<span class="cm-comment"># The same result, but faster:</span>
<span class="cm-variable-2">$image</span>:       //<span class="cm-tag-2">div</span>[<span class="cm-variable">has-class</span>(<span class="cm-string">"image"</span>)]
<span class="cm-tag">&lt;cite&gt;</span>:       <span class="cm-variable-2">$image</span>//<span class="cm-tag-2">p</span>/<span class="cm-tag-2">span</span>
<span class="cm-tag">&lt;figcaption&gt;</span>: <span class="cm-variable-2">$image</span>//<span class="cm-tag-2">p</span>
<span class="cm-tag">&lt;figure&gt;</span>:     <span class="cm-variable-2">$image</span></pre>
                <h4>
                  <a class="anchor-link" href="#repeat"
                    ><i class="anchor-icon"></i></a
                  ><a class="anchor" name="repeat" id="repeat"></a>repeat
                </h4>
                <pre
                  class="cm-s-default"
                ><span class="cm-builtin">@repeat</span>(<span class="cm-variable">n</span>) {
  <span class="cm-comment"># block of rules</span>
}</pre>
                <p>
                  Executes a block of rules <strong>n</strong> times. At the
                  beginning of each iteration, the following variables will be
                  set:
                </p>
                <ul>
                  <li>
                    <code>$$</code> and <code>$@</code> will contain the
                    previous value of <code>$$</code>;
                  </li>
                  <li>
                    <code>$index</code> will contain the index of the current
                    iteration (starts with 1);
                  </li>
                  <li>
                    <code>$first</code> will contain
                    <code>&lt;true&gt;</code> if this is the first iteration, an
                    empty list otherwise;
                  </li>
                  <li>
                    <code>$middle</code> will contain
                    <code>&lt;true&gt;</code> if the current iteration is
                    between the first and last, empty list otherwise;
                  </li>
                  <li>
                    <code>$last</code> will contain <code>&lt;true&gt;</code> if
                    this is the last iteration, empty list otherwise.
                  </li>
                </ul>
                <p><strong>Example</strong></p>
                <pre
                  class="cm-s-default"
                ><span class="cm-comment"># appends "1, 2, 3, 4, 5" to $body</span>
<span class="cm-builtin">@repeat</span>( <span class="cm-number">5</span> ) {
  <span class="cm-builtin">@append_to</span>(<span class="cm-variable-2">$body</span>): <span class="cm-variable-2">$index</span>
  <span class="cm-builtin">@if_not</span>( <span class="cm-variable-2">$last</span> ) {
    <span class="cm-builtin">@append_to</span>(<span class="cm-variable-2">$body</span>): <span class="cm-string">", "</span>
  }
}</pre>
                <h4>
                  <a class="anchor-link" href="#while"
                    ><i class="anchor-icon"></i></a
                  ><a class="anchor" name="while" id="while"></a>while
                </h4>
                <pre
                  class="cm-s-default"
                ><span class="cm-builtin">@while</span>(<span class="cm-variable">xpath_query</span>) {
  <span class="cm-comment"># block of rules</span>
}</pre>
                <p>
                  Executes a block of rules while target nodes exist on the
                  current page. At the beginning of each iteration the following
                  variables will be set:
                </p>
                <ul>
                  <li>
                    <code>$$</code> and <code>$@</code> will contain target
                    nodes found by XPath query;
                  </li>
                  <li>
                    <code>$index</code> will contain the index of the current
                    iteration (starts with 1);
                  </li>
                  <li>
                    <code>$first</code> will contain
                    <code>&lt;true&gt;</code> if it is the first iteration, an
                    empty list otherwise.
                  </li>
                </ul>
                <p><strong>Example</strong></p>
                <pre
                  class="cm-s-default"
                ><span class="cm-builtin">@while</span>( //<span class="cm-tag-2">iframe</span> ) {
  <span class="cm-builtin">@inline</span>: <span class="cm-variable-2">$@</span>          <span class="cm-comment"># inline all nested iframes</span>
}</pre>
                <h4>
                  <a class="anchor-link" href="#while-not"
                    ><i class="anchor-icon"></i></a
                  ><a class="anchor" name="while-not" id="while-not"></a
                  >while_not
                </h4>
                <pre
                  class="cm-s-default"
                ><span class="cm-builtin">@while_not</span>(<span class="cm-variable">xpath_query</span>) {
  <span class="cm-comment"># block of rules</span>
}</pre>
                <p>
                  Executes a block of rules while target nodes do not exist on
                  the current page. At the beginning of each iteration the
                  following variables will be set:
                </p>
                <ul>
                  <li>
                    <code>$$</code> and <code>$@</code> will contain target
                    nodes found by XPath query;
                  </li>
                  <li>
                    <code>$index</code> will contain the index of the current
                    iteration (starts with 1);
                  </li>
                  <li>
                    <code>$first</code> will contain
                    <code>&lt;true&gt;</code> if this is the first iteration, an
                    empty list otherwise.
                  </li>
                </ul>
                <p><strong>Example</strong></p>
                <pre
                  class="cm-s-default"
                ><span class="cm-builtin">@while_not</span>( //<span class="cm-tag-2">video</span> ) {   <span class="cm-comment"># if no video exists on the current page</span>
  <span class="cm-builtin">@inline</span>: //<span class="cm-tag-2">iframe</span>       <span class="cm-comment">#   try to inline iframes, maybe video is inside the frame</span>
}</pre>
                <h3>
                  <a class="anchor-link" href="#embedded-elements"
                    ><i class="anchor-icon"></i></a
                  ><a
                    class="anchor"
                    name="embedded-elements"
                    id="embedded-elements"
                  ></a
                  >Embedded elements
                </h3>
                <p>
                  Instant View supports widgets from popular services. We
                  display them as embedded elements or specially formatted
                  quotes. The Instant View bot analyzes all iframes in the
                  document body and generates a widget if the service is
                  supported.
                </p>
                <blockquote>
                  <p>
                    Some popular widgets do not use iframes. Note that the
                    <code>..after</code> block of rules contains rules to
                    transform such widgets to an Instant View compatible format.
                  </p>
                </blockquote>
                <p>We currently support the following services:</p>
                <ul>
                  <li>Youtube</li>
                  <li>Vimeo</li>
                  <li>Tweets &amp; Twitter Videos</li>
                  <li>Facebook Posts &amp; Videos</li>
                  <li>Instagram</li>
                  <li>Giphy</li>
                  <li>SoundCloud</li>
                  <li>GithubGist</li>
                  <li>Aparat</li>
                  <li>VK.com Videos</li>
                </ul>
                <h3>
                  <a class="anchor-link" href="#processing-pages"
                    ><i class="anchor-icon"></i></a
                  ><a
                    class="anchor"
                    name="processing-pages"
                    id="processing-pages"
                  ></a
                  >Processing pages
                </h3>
                <p>All pages are processed according to the following rules:</p>
                <pre
                  class="cm-s-default"
                ><span class="cm-comment"># Url: http://example.com/some_page.html</span>
<span class="cm-variable-3">+ example.com</span>
<span class="cm-def">?true</span>
<span class="cm-variable-3">+ ..after</span></pre>
                <p>
                  If a page is on a third-level domain and above, the following
                  rules are applied:
                </p>
                <pre
                  class="cm-s-default"
                ><span class="cm-comment"># Url: http://some.subdomain.example.com/some_page.html</span>
<span class="cm-variable-3">+ some.subdomain.example.com</span>
<span class="cm-def">?not_exists</span>: <span class="cm-variable-2">$body</span>
<span class="cm-variable-3">+ subdomain.example.com</span>
<span class="cm-def">?not_exists</span>: <span class="cm-variable-2">$body</span>
<span class="cm-variable-3">+ example.com</span>
<span class="cm-def">?true</span>
<span class="cm-variable-3">+ ..after</span></pre>
                <p>
                  In other words, at first the bot attempts to use a block of
                  rules that features the full domain name. If such a block does
                  not exist, the bot checks for the next level up to the
                  second-level domain.
                </p>
                <p>
                  <code>..after</code> is a special block of rules that is
                  applied to all pages irrespective of the domain name.
                </p>
                <h4>
                  <a class="anchor-link" href="#working-with-subdomains"
                    ><i class="anchor-icon"></i></a
                  ><a
                    class="anchor"
                    name="working-with-subdomains"
                    id="working-with-subdomains"
                  ></a
                  >Working with subdomains
                </h4>
                <p>
                  If the page is on a third-level domain or higher, you need to
                  manually select the domain level to which your template will
                  apply. Use this menu in the top left corner of the page:
                </p>
                <div>
                  <a
                    href="/file/811140424/1/iHfwojr4Vgs.13156/e22aeb9d421eb01c85"
                    target="_blank"
                    ><img
                      src="/file/811140424/1/iHfwojr4Vgs.13156/e22aeb9d421eb01c85"
                      title="Select domain level"
                      style="max-width: 300px"
                      class="dev_page_image" /></a
                  ><br />
                </div>

                <p>
                  Choose a level that hosts pages with the same structure, so
                  that your rules are relevant to all the matching pages on this
                  domain.
                </p>
                <blockquote>
                  <p>
                    For example, use <code>wikipedia.org</code> to create an IV
                    page for
                    <code>https://en.wikipedia.org/wiki/Domain_name</code>
                    because the page structure doesn't depend on language in
                    Wikipedia.
                  </p>
                </blockquote>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <script src="/js/jquery.min.js?1"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/main.js?41"></script>
    <script src="/js/codemirror/codemirror.js?1"></script>
    <script src="/js/codemirror/simple.js?1"></script>
    <script src="/js/codemirror/runmode.js?1"></script>
    <script src="/js/codemirror-instantview.js?21"></script>
    <script src="/js/instantview.js?71"></script>

    <script>
      $(window).resize(updateNavBar);
      updateNavBar();
      window.initDevPageNav && initDevPageNav();
      $("pre")
        .addClass("cm-s-default")
        .each(function () {
          CodeMirror.runMode($(this).text(), "instantview", this);
        });
      $("body").on("activate.bs.scrollspy", function () {
        var head_active_el = $(".header-nav li.active[data-side-nav-item]");
        if (head_active_el.length) {
          head_active_el
            .removeClass("active")
            .wrapInner('<a href="/docs#"></a>');
          head_active_el.after('<li class="active"></li>');
        }
        head_active_el = $(".header-nav li.active");
        var active_el = $(".dev_side_nav li.active > a").last();
        head_active_el.text(active_el.text());
      });
    </script>

    <!-- page generated in 47.7ms -->
  </body>
</html>
